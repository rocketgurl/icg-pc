function loadingOn(e){var t=e.find(".form_actions"),n=$('<span class="loading">Loading</span>');t.addClass("loadingOn").bind("ajaxComplete",function(){t.removeClass("loadingOn"),t.find(".loading").remove()}),t.find(".loading").length===0&&t.append(n)}function show(e,t){var n,r={},i=function(n,r){var i={},s=n;r.product&&n!=="home"&&n!=="login"&&(s=n+"-"+r.product,i.templateLoc="./products/"+r.product+"/forms/"+n.replace(/_/g,"-")+"/",i.filename="view"),mxAdmin.loadTemplate(s,r,function(r){$("#contents").html(r);try{typeof view!="undefined"&&view[n]&&view[n].load&&view[n].load(t||{}),view.onReady()}catch(i){throw typeof error!="undefined"?error('Unhandled error while loading "'+e+'" page',i.message):typeof console.log!="undefined"&&console.log('Unhandled error while loading "'+e+'" page',i.message),i}},i)};t=t||{};if(!e)return;e[0]==="/"&&(e=e.substr(1)),n=e,document.body.id=e;if(typeof view!="undefined"&&view[n]&&view[n].view)try{if(!CTX.policy)return $.address.value(mxAdmin.homeAddress);mxAdmin.dataModel({productName:CTX.product,viewName:n.replace(/_/g,"-"),success:function(s){view[n].vocabTerms=s,r=view[n].view(CTX,t,e),r.policy&&(r=$.extend(!0,r,mxAdmin.helpers.getPolicyOverview(r.policy.InsurancePolicy)),r.policyOverview=!0),i(n,r)}})}catch(s){console.error("In base.js:show() There was a problem trying to use Mustache to populate the template.",s)}else{if(CTX.policy)r=$.extend(!0,CTX,mxAdmin.helpers.getPolicyOverview(CTX.policy.InsurancePolicy)),r.policyOverview=!0;else{if(n!=="home"&&n!=="login")return $.address.value(mxAdmin.homeAddress);r=CTX}i(n,r)}}function _preflight_credentials(){var e=com.ics360.ixdirectory.getAuthorizationHash();return e===!1&&(e=cookie.get("mxadmin.login")),e||console.error("Don't have a working set of credentials."),e}function _itemGet(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n].$name===t)return e[n].$value}var mxAdmin={};window.mxAdmin=mxAdmin,mxAdmin.homeAddress="home",mxAdmin.loadTemplate=function(e,t,n,r){var i={filename:e,extension:"html",dataType:"html",templateLoc:"./templates/",error:function(e){console.log("There was an error retrieving the template",e)}},s=null,o=null,u=null,a=function(){o=ich[e](t),$.isFunction(n)&&n(o)};s=$.extend(i,r||{}),ich[e]?a():(u=s.templateLoc+s.filename,u+="."+s.extension,$.ajax({url:u,type:"GET",dataType:s.dataType,success:function(t){ich.addTemplate(e,t),a()},error:s.error}))},mxAdmin.dataModelCache={},mxAdmin.dataModel=function(e){var t={},n=$.extend(t,e||{}),r=!0,i=mxAdmin.dataModelCache[n.productName],s=null,o=function(e){$.isFunction(n.success)&&n.success(e)};i?(s=i[n.viewName],s&&(r=!1,o(s))):(mxAdmin.dataModelCache[n.productName]={},i=mxAdmin.dataModelCache[n.productName]);if(r)try{$.ajax({type:"GET",url:"./products/"+n.productName+"/forms/"+n.viewName+"/model.json",dataType:"json",success:function(e){var t=null;e?t=e.terms:t=[],i[n.viewName]=t,o(t)},error:function(e){e.status===404?(alert("Unable to find a data model for the "+n.viewName+" action of the "+n.productName+" product. Aborting request."),$.address.value(mxAdmin.homeAddress)):console.log("There was an error making the Ajax request",e)}})}catch(u){}},function(e){"use strict";e.helpers=function(){var e={};return e.getDataItem=function(e,t){if(!e)return;var n=null,r=0,i=0,s=e.length,o=null,u=null;for(r;r<s;r+=1){u=e[r];if(u.$name.substr(0,2)!=="Op")continue;if(u.$name.substr(2)===t){o=u.$value;break}}if(!o)for(i;i<s;i+=1){u=e[i];if(u.$name===t){n=u.$value;break}}else n=o;return n},e.getDataItemValues=function(t,n){var r={},i=0,s="",o=n.length;for(i;i<o;i+=1)s=n[i].name,r[s]=e.getDataItem(t,s),r[s]===null&&delete r[s];try{r.CoverageA&&r.CoverageD&&(r.CoverageD=Math.round(~~r.CoverageA*.2))}catch(u){}return r=e.setEnumerations(r,n),r},e.getChangedDataItems=function(e,t){var n=[],r=0,i=e.$changed.length,s={},o=null;if(i>0)for(r;r<i;r+=1)o=e.$changed[r],mxAdmin.helpers.objectInArray(o,t,"name")>-1&&(s.$name=o,s.$value=e[o],n.push(s),s={});return n},e.getPolicyOverview=function(t){var n=t.Customers.Customer,r=[],i=[{name:"InsuredFirstName"},{name:"InsuredMiddleName"},{name:"InsuredLastName"},{name:"InsuredMailingAddressLine1"},{name:"InsuredMailingAddressLine2"},{name:"InsuredMailingAddressCity"},{name:"InsuredMailingAddressState"},{name:"InsuredMailingAddressZip"}],s;for(s in n)if(n[s].$type&&n[s].$type==="Insured"){r=n[s].DataItem;break}return e.getDataItemValues(r,i)},e.setEnumerations=function(e,t){var n=0,r=t.length,i=null,s={value:"",label:"Select"};for(n;n<r;n+=1)i=t[n],i.enumerations&&i.enumerations.length>0&&(e["Enums"+i.name]=[].concat(s,i.enumerations));return e},e.objectInArray=function(e,t,n){var r=0,i=-1,s=t.length;for(r;r<s;r+=1)if(t[r][n]==e){i=r;break}return i},e.isFloat=function(e){var t=null;return isNaN(e)||e.indexOf(".")<0?t=!1:parseFloat(e)?t=!0:t=!1,t},e.formatMoney=function(e){return e+".00"},e.isEmpty=function(e){var t=!0,n;for(n in e)e.hasOwnProperty(n)&&(t=!1);return t},e.stripTimeFromDate=function(e){var t=e,n=e.indexOf("T");return n>-1&&(t=t.substring(0,n)),t},e.cleanDate=function(t,n){var r=n||"MM/dd/yyyy";return Date.parse(e.stripTimeFromDate(t)).toString(r)},e.displayMsg=function(e){var t={type:"",title:"",msg:""},n=$.extend(t,e),r=$("<div />",{"class":"content_msg"});r.addClass(n.type),n.title&&r.append("<h3>"+n.title+"</h3>"),n.msg&&r.append("<p>"+n.msg+"</p>"),$("div.content_msg."+n.type).remove(),$("div.content_body").before(r)},e}()}(mxAdmin);var CTX={},LOGIN_COOKIE="mxadmin.login",HOME="home";if(!window.console||!window.console.log)window.console={log:function(){},error:function(){}};Object.keys||(Object.keys=function(e){if(e!==Object(e))throw new TypeError("Object.keys called on a non-object");var t=[],n;for(n in e)return Object.prototype.hasOwnProperty.call(e,n)&&t.push(n),t}),Number.formatMoney||(Number.prototype.formatMoney=function(e,t,n){var r=this,e=isNaN(e=Math.abs(e))?2:e,t=t==undefined?".":t,n=n==undefined?",":n,i=r<0?"-":"",s=parseInt(r=Math.abs(+r||0).toFixed(e),10)+"",o=(o=s.length)>3?o%3:0;return i+(o?s.substr(0,o)+n:"")+s.substr(o).replace(/(\d{3})(?=\d)/g,"$1"+n)+(e?t+Math.abs(r-s).toFixed(e).slice(2):"")}),$("body").bind("success error",function(e){view.message.apply(null,arguments)}),$.address.change(function(e){if(e.path==="/logout"){cookie.unset(LOGIN_COOKIE),$.address.value(HOME);return}cookie.get(LOGIN_COOKIE)?(CTX.user||(CTX.user=Base64.decode(cookie.get(LOGIN_COOKIE)).split(":")[0],view.banner.update()),show(e.pathNames[0])):show("login")}).history(!0),$(function(){com.ics360.ixdirectory.init("./ixdirectory/api/rest/v2/"),model.pxcentral.init("./pxcentral/api/rest/v1/"),model.ixlibrary.init("./ixlibrary/api/sdo/rest/v1/"),model.ixdoc.init("./ixdoc/api/rest/v2/"),$.address.value()==="/"&&$.address.value(mxAdmin.homeAddress)});var view={},view_validators={money:function(e){return parseFloat(e.val())>0},dateRange:function(e){var t=Date.parse(e.data("minDate")),n=Date.parse(e.data("maxDate")),r=Date.parse(e.val());return r.between(t,n)}},elemValidToType=function(e){var t={number:function(e){var t=!0,n=parseInt(e.val(),10),r=null,i=null;return e.attr("min")&&(r=parseInt(e.attr("min"),10),n<r&&(t=!1)),e.attr("max")&&(i=parseInt(e.attr("max"),10)),t}},n=t[e.attr("type")]||null;return n?n(e):!0},fieldIsValid=function(e){var t=$(e),n=t.parents("form").attr("action")||$.address.pathNames[0]||mxAdmin.homeAddress,r=view[n].validators||null,i=$("label[for='"+t.attr("id")+"']"),s=t.val()||null,o=t.attr("required")?!0:!1,u="validation_error";return o&&s===null||!elemValidToType(t)||r&&s&&r[t.attr("name")]&&!r[t.attr("name")](t)?(i.addClass(u),t.addClass(u),!1):(i.removeClass(u),t.removeClass(u),!0)};formIsValid=function(e){var t=!0,n=$(e).attr("action")||$.address.pathNames[0]||mxAdmin.homeAddress,r=view[n].validators||null;return $(":input",e).each(function(e,n){fieldIsValid(n)||(t=!1)}),t},notifyOfError=function(e){var t=e.find(".validation_error:eq(0)"),n=t.closest(".collapsibleFieldContainer"),r=0;n.length>0&&n.is(":hidden")&&(r=95,n.parent().find("h3:eq(0)").click()),setTimeout(function(){window.scrollTo(0,t.offset().top)},r)},formSubmitHandler=function(e){var t=$(this),n=t.attr("action")||$.address.pathNames[0]||mxAdmin.homeAddress,r=null,i=function(e){var t={};return $.each(e.serializeArray(),function(e,n){var r=n.name,i=n.value;t[r]?(t[r].push||(t[r]=[t[r]]),t[r].push(i)):t[r]=i}),t},s=function(e){var t=[];return $(":input",e).each(function(e,n){var r=$(n),i=r.val(),s=r.attr("name");r.is("select")?r.data("value")!=i&&t.push(s):r.is("textarea")?(i.trim()!==""&&t.push(s),i.trim()===""&&r.data("hadValue")&&t.push(s)):i!=n.getAttribute("value")&&t.push(s)}),t};e.preventDefault();if(!formIsValid(t)){notifyOfError(t);try{view[n].error()}catch(e){}return!1}loadingOn(t),r=i(t),r.$changed=s(t),r.preview&&(CTX.preview=r.preview),view[n]?view[n].load(r):show(n,r)},view.onReady=function(){var coverage_calculations,$coverage_a=$("#id_CoverageA");if($coverage_a.length>0){var data=$coverage_a.data("calculations");coverage_calculations=eval("("+data+")")}var coverageACalcs=function(){var e;$coverage_a.length>0&&(e=$coverage_a.val());if(typeof e!="undefined"||e!==null)if(coverage_calculations!==null)for(i in coverage_calculations){var t=e*parseFloat(coverage_calculations[i]);$("input[name="+i+"]").val(t)}},coverageFieldCalcs=function(){$("select[data-affects]").each(function(e){var t=$(this);t.val()&&$("input[name="+t.data("affects")+"]").trigger("coverage.calculate",t.val())})};$("select[data-value]").val(function(e,t){return $(this).attr("data-value")});var coverage_l=$("select[name=CoverageL]"),coverage_m=$("select[name=CoverageM]");CTX.product==="ofcc-dp3-ny"&&coverage_l!==null&&coverage_m!==null&&(coverage_l.change(function(){$(this).val()==="0"&&coverage_m.val("0"),parseInt($(this).val(),10)>0&&coverage_m.val()==="0"&&coverage_m.val("")}),coverage_m.change(function(){$(this).val()!=="0"&&coverage_l.val()==="0"&&$(this).val("0")})),$("form").attr("novalidate","novalidate").bind("submit",formSubmitHandler).each(function(e,t){formIsValid(t)}),$("#content .datepicker:not(.custom)").each(function(){var e=$(this).data("minDate")||null,t=$(this).data("maxDate")||null,n=$(this).data("yearRange")||"-30:+10";e!==null&&(e=mxAdmin.helpers.cleanDate(e)),t!==null&&(t=mxAdmin.helpers.cleanDate(t)),$(this).datepicker({yearRange:n,minDate:e,maxDate:t,changeMonth:!0,changeYear:!0})}),$("input[name=CoverageA]").bind("input",function(){coverageFieldCalcs(),coverageACalcs()}),$("select[data-affects]").change(function(e){var t=$(this).data("affects");$("input[name="+t+"]").trigger("coverage.calculate",$(this).val())}),$("input").bind("coverage.calculate",function(e,t){var n=parseInt($("input[name=CoverageA]").val(),10),r=Math.round(n*t/1e4);$(this).val(r)}),$("a").live("click",function(e){var t=$(this).attr("href");e.preventDefault(),t&&t!=="#"&&$.address.value(t)}),coverageFieldCalcs(),view.editableFormSections.init(),$(":input").on("change",function(e){fieldIsValid(e.target)})},view.message=function(e,t,n,r){var i=$("<div />",{"class":"content_msg"}),s=e.type,o=n||null;i.addClass(s),i.append($("<h3 />",{text:t})),o!==null&&i.append($("<p />",{html:o})),r&&function(){var e="Show error details +",t="Hide error details -",n=$("<a />",{text:e,href:"#",click:function(e){e.preventDefault(),$(this).next().toggle()}}),s=$("<div />",{"class":"error_details"});s.append(n).append(r),i.append(s),n.toggle(function(){$(this).text(t)},function(){$(this).text(e)})}(),$(".loading").remove(),$("#home li input.tempDisabled").removeClass("tempDisabled").removeAttr("disabled"),$("div.content_msg").remove(),$("#content_header, #policy_num_input").after(i),s==="success"&&setTimeout(function(){$("div.content_msg."+s).animate({opacity:0},200).delay(150).animate({height:0},150,function(){$(this).remove()})},8e3)},view.request_success=function(e){var t={title:"Action completed successfully",desc:null},n=$.extend(!0,t,e);return function(){$.address.value(HOME),$("body").trigger("success",[n.title,n.desc])}},view.request_error=function(e,t,n){e||$("body").trigger("error",[t||"Unknown HTTP error","Some sort of major problem occurred with the request. It's bad enough that mxAdmin didn't even get an error message."]);var r=e.status,i=e.getResponseHeader("X-True-Statuscode")||null,s=$("<div />",{css:{display:"none"},html:e.responseText}),o=null,u=null,a=null;$("body").append(s),o=s.find("h1:first").text(),u=s.find("p:first").text(),a=s.find("ol:first"),a.length<=0&&(a=s.find("ul:first"),a.length<=0&&(a=null)),s.remove(),i===null&&(o=r+" "+o),$("body").trigger("error",[o,u,a])},view.editableFormSections={init:function(){$("form.collapsedSections fieldset h3").click(function(e){try{var t=$(this).find("a"),n=t.data("altText"),r=t.text();t.text(n).data("altText",r)}catch(e){}$(this).parent().find("div.collapsibleFieldContainer").slideToggle(75)}),$("form.collapsedSections fieldset.defaultOpen h3").click()}},view.banner={update:function(){var e=$("#user_info a:last").detach();$("#user_info").text(CTX.user+" | ").append(e)}},view.initPreview=function(e){$("#updatePreview").attr("disabled",!0),$("tr.calc_row input").each(function(e,t){var n=$(this).closest("tr.calc_row"),r=parseInt($(this).parent().prev().text(),10)||0,i=$(this).parent().next(),s=n.find("td.subtotal");$(this).bind("keyup",function(e){var t=~~this.value,n=~~s.text();i.text(r+t),s.trigger("adjust"),$("#updatePreview").attr("disabled",!1)})}),$("tr.calc_row").each(function(e,t){var n=$(this).find("td.calculated_value"),r=$(this).find("td.subtotal"),i=$(this).find("td.fees"),s=$(this).find("td.total"),o=parseInt(r.text(),10)||0,u=parseInt(i.text(),10)||0,a=parseInt(s.text(),10)||0;r.bind("adjust",function(){var e=0,t=0;n.each(function(t,n){var r=parseInt($(this).text(),10)||0;e+=r}),r.text(e),s.text(e+u)})}),$(e).data("initialized")||($(e).data("initialized",!0),$("#updatePreview").live("click",function(){$(this.form).append('<input type="hidden" id="id_preview" name="preview" value="re-preview">').submit()}))},view.login={load:function(e){e.username&&e.password&&model.login(e.username,e.password,function(e){CTX.user=e,view.banner.update(),show($.address.path())})},error:function(){mxAdmin.helpers.displayMsg({type:"error",title:"Invalid username or password"})}},view.home={load:function(e){$("#id_identifier").focus(),$("#id_identifier").is(":focus")&&$("#id_identifier").keydown(function(e){e.which===13&&e.preventDefault()}),$("input[type=submit]").live("click",function(e){$("#page_action").val($(this).attr("name"))}),delete CTX.params,delete CTX.preview,e.identifier&&($("#home li input").addClass("tempDisabled").attr("disabled","disabled"),$("#id_identifier").parent().append($("<span />",{"class":"loading"})),model.pxcentral.policy.get(e.identifier,function(t){if(!t.InsurancePolicy)return $("body").trigger("error",["Could not find Policy "+e.identifier]),!1;var n=model.policy(t.InsurancePolicy),r=e.page_action,i=null,s=null;if(n.quote)return $("body").trigger("error",[e.identifier+" is a quote and cannot be managed with mxAdmin"]),!1;switch(r){case"issue":if(n.issued)return $("body").trigger("error",["Policy "+e.identifier+" already issued"]),!1;break;case"renew":if(n.cancelled||n.pendingCancel)return mxAdmin.dataModel({productName:n.productName,viewName:"cancellation",success:function(t){i="Policy "+e.identifier+" is not eligible for renewal",s=function(){try{var e="",r=!1,i=mxAdmin.helpers.cleanDate(n.cancellationEffectiveDate),s=n.cancellationReasonCode,o=s,u={};for(var a=0,f=t[0].enumerations.length;a<f;a++){u=t[0].enumerations[a];if(u.value===s){o=u.label;break}}}catch(l){console.log("The PolicyState element of this policy does not contain the needed cancellationEffectiveDate or cancellationReasonCode attributes",l),i=null,s=null,o=null,r=!0}return n.cancelled?(e="This policy was cancelled",r||(e+=" on <strong>"+i+"</strong>",e+=" due to <strong>"+o+"</strong>")):n.pendingCancel&&(e="This policy is pending cancellation",r||(e+=" effective <strong>"+i+"</strong>",e+=" due to <strong>"+o+"</strong>")),e}(),$("body").trigger("error",[i,s])}}),!1}CTX.policy=t,CTX.policyId=e.identifier,CTX.product=n.productName,$.address.value(e.page_action)},view.request_error))},validators:{page_action:function(e){return e.val()!=="none"}}},view.issue={view:function(e){if(!e.policy)return e;var t={};return t.msg=!0,t.msgType="info",t.msgText="Company accepts binder and agrees to issue policy package.",$.extend(!0,{},e,t)},load:function(e){if(!CTX.policy)return $.address.value(mxAdmin.homeAddress);var t=model.policy(CTX.policy.InsurancePolicy),n=null;e&&!mxAdmin.helpers.isEmpty(e)&&(e.transactionType="Issuance",e.effectiveDate=t.lastTerm.EffectiveDate,n=model.transactionRequest(CTX.policy).issue(e),model.pxcentral.policy.set(t.id,n))}},view.issue_manual={load:function(e){if(!CTX.policy)return $.address.value(mxAdmin.homeAddress);var t=model.pxcentral.policy.id(CTX.policy),n=(new Date).toISOString().replace(/:|\.\d{3}/g,""),r=model.ixlibrary.policy.url(t),i=model.ixlibrary.slugs.issue.objKey+"-"+n,s=model.ixlibrary.slugs.issue.decKey+"-"+n,o=null;e&&!mxAdmin.helpers.isEmpty(e)?(e.changeType="ISSUE",e.formattedMDY=(new Date).toString("M/d/yy"),o=model.policyChangeSet(CTX.policy).issue_manual(e),model.pxcentral.policy.set(t,o)):(model.ixlibrary.policy.bindField("id_package",r,i,function(e){$("#id_package").after('<input type="hidden" name="packageDoc" value="'+i+'">').after('<input type="hidden" name="idtimestamp" value="'+n+'">')}),model.ixlibrary.policy.bindField("id_declaration",r,s,function(e){$("#id_declaration").after('<input type="hidden" name="declarationDoc" value="'+s+'">')}))}},view.invoice={load:function(e){if(!CTX.policy)return $.address.value(HOME);var t=model.pxcentral.policy.id(CTX.policy),n=null,r=new Date,i=r.toString("M/d/yy"),s=r.toISOString().replace(/:|\.\d{3}/g,"");e&&!mxAdmin.helpers.isEmpty(e)&&(e.InvoiceDateCurrent=r.toString("M/d/yyyy"),e.changeType="INVOICE",e.reasonCode="INVOICE",e.documentType="Invoice",e.documentLabel="Invoice "+i,e.documentHref="",e.documentId=e.documentType+"-"+s,mxAdmin.helpers.isFloat(e.InvoiceAmountCurrent)||(e.InvoiceAmountCurrent=mxAdmin.helpers.formatMoney(e.InvoiceAmountCurrent)),e.installmentCharge&&!mxAdmin.helpers.isFloat(e.installmentCharge)&&(e.installmentCharge=mxAdmin.helpers.formatMoney(e.installmentCharge)),n=model.policyChangeSet(CTX.policy).invoice(e),model.pxcentral.policy.set(t,n))},validators:{InvoiceAmountCurrent:view_validators.money,installmentCharge:view_validators.money}},view.make_payment={vocabTerms:null,view:function(e,t){if(!e.policy)return e;var n=model.pxcentral.policy.getLastTerm(e.policy.InsurancePolicy),r=n.DataItem,i=mxAdmin.helpers.getDataItemValues(r,this.vocabTerms);return $.extend(!0,{},e,t,i)},load:function(e){if(!CTX.policy)return $.address.value(mxAdmin.homeAddress);var t=model.pxcentral.policy.id(CTX.policy),n=model.ixlibrary.policy.url(t),r=null;e&&!mxAdmin.helpers.isEmpty(e)&&(e.paymentAmount=-1*Math.abs(e.paymentAmount||0),e.positivePaymentAmount=Math.abs(e.paymentAmount||0),r=model.policyChangeSet(CTX.policy).make_payment(e),model.pxcentral.policy.set(t,r))}},view.reverse_payment={vocabTerms:null,view:function(e,t){if(!e.policy)return e;var n=model.pxcentral.policy.getLastTerm(e.policy.InsurancePolicy),r=n.DataItem,i=mxAdmin.helpers.getDataItemValues(r,this.vocabTerms);return $.extend(!0,{},e,t,i)},load:function(e){if(!CTX.policy)return $.address.value(HOME);var t=model.pxcentral.policy.id(CTX.policy),n=model.ixlibrary.policy.url(t),r=null;e&&!mxAdmin.helpers.isEmpty(e)&&(e.paymentAmount=Math.abs(e.paymentAmount||0),r=model.policyChangeSet(CTX.policy).reverse_payment(e),model.pxcentral.policy.set(t,r))}},view.cancellation={vocabTerms:null,view:function(e){if(!e.policy)return e;var t=e.policy.InsurancePolicy,n=t.Management,r=n.PolicyState,i=null,s=n.PendingCancellation||null,o={},u=mxAdmin.helpers.setEnumerations({},this.vocabTerms).EnumsReasonCodesAndLabels,a=null,f=null;o.policyEffectiveDate=model.pxcentral.policy.getEffectiveDate(t),o.policyExpirationDate=model.pxcentral.policy.getExpirationDate(t),typeof r=="string"?i=r:i=r.$,s!==null?(a=mxAdmin.helpers.objectInArray(s.$reasonCode,u,"value"),f=u[a].label,o.pendingCancel=!0,o.pendingCancelReasonCode=s.$reasonCode,o.pendingCancelReasonCodeLabel=f,o.cancellationEffectiveDate=mxAdmin.helpers.cleanDate(s.$cancellationEffectiveDate)):(o.pendingCancel=!1,o.pendingCancelReasonCode=null,o.pendingCancelReasonCodeLabel=null,o.cancellationEffectiveDate=null);switch(i){case"ACTIVEPOLICY":s===null?(o.cancelDisabled="",o.pendingDisabled="",o.reinstateDisabled="disabled",o.rescindDisabled="disabled",o.pendingCancelReasonCode=null,o.cancellationEffectiveDate=null,o.msg=!1,o.msgType=null,o.msgHeading=null,o.msgText=null):(o.cancelDisabled="",o.reinstateDisabled="disabled",o.pendingDisabled="disabled",o.rescindDisabled="",o.msg=!0,o.msgType="info",o.msgHeading="This is an active policy that is pending cancellation.",o.msgText="Cancellation is effective <b>"+o.cancellationEffectiveDate+"</b> due to <b>"+f+"</b>");break;case"CANCELLEDPOLICY":a=mxAdmin.helpers.objectInArray(r.$reasonCode,u,"value"),f=u[a].label,o.cancelDisabled="disabled",o.pendingDisabled="disabled",o.rescindDisabled="disabled",o.reinstateDisabled="",o.msg=!0,o.msgType="info",o.msgHeading="This is a cancelled policy.";try{o.msgText="Cancellation took effect <b>"+mxAdmin.helpers.cleanDate(r.$effectiveDate)+"</b> due to <b>"+f+"</b>"}catch(l){}}return e=$.extend(!0,e,o),e},load:function(e){var t=e._confirm_cancellation_view_name;if(!CTX.policy)return $.address.value(HOME);CTX.latestTerm=model.pxcentral.policy.getLastTerm(CTX.policy.InsurancePolicy),$("input[type=submit]").live("mouseup",function(e){$("#page_action").val($(this).attr("name"))}),$.address.value(e.page_action)},actionView:function(e){return function(t,n){if(!t.policy)return t;var r=model.pxcentral.policy.getLastTerm(t.policy.InsurancePolicy),i=r.DataItem,s=mxAdmin.helpers.getDataItemValues(i,e.context[e.viewName].vocabTerms);return $.extend(!0,{},t,n,s)}},actionLoad:function(e){var t={pcsType:null,title:null,desc:null},n=$.extend(!0,t,e);return function(e){if(!CTX.policy)return $.address.value(HOME);var t=this,r=null,i=e,s=null,o=$.noop;CTX.current_policy=view.endorse.parseIntervals(CTX),e&&!mxAdmin.helpers.isEmpty(e)&&(e.pcsType=n.pcsType,e.comment===""&&(e.comment="__deleteEmptyProperty"),e.effectiveDate||(e.effectiveDate="__deleteEmptyProperty"),r=model.transactionRequest(CTX.policy).cancellation(e),s=model.pxcentral.policy.id(CTX.policy),e.preview&&model.pxcentral.policy.set(s,r,{headers:{"X-Commit":!1},callback:function(o){var u=$.extend({},CTX);u.policy=o,delete e.preview,delete CTX.preview,CTX.params=e,u.params=i,t.preview(u,{cancel:function(){$.address.value(HOME)},confirm:function(){model.pxcentral.policy.set(s,r,{callback:view.request_success(n)})}})}}))}},preview:function(e){return function(t,n){var r=this,i=model.policy(t.policy.InsurancePolicy),s="cancellation-"+CTX.product,o={cancel:$.noop,confirm:$.noop},n=$.extend(!0,o,n);formatMoney=function(e){return h="$"+parseFloat(e).formatMoney(2,".",","),h};var u=864e5,a;for(var f=t.policy.InsurancePolicy.EventHistory.Event.length-1;f>=0;f--){var l=t.policy.InsurancePolicy.EventHistory.Event[f].$type;if(l=="Cancel"||l=="PendingCancellation"){t.Action=l=="Cancel"?"Cancellation":"Pending Cancellation",a=t.policy.InsurancePolicy.EventHistory.Event[f];break}}for(var f=0;f<a.DataItem.length;f++){var c,h,p=a.DataItem[f];p.$name=="AppliedDate"?t.AppliedDate=p.$value:p.$name=="reasonCode"?t.ReasonCode=p.$value:p.$name=="reasonCodeLabel"?t.ReasonCodeLabel=p.$value:p.$name=="EffectiveDate"?t.EffectiveDate=p.$value:p.$name=="ChangeInPremium"?t.ChangeInPremium=formatMoney(p.$value):p.$name=="ChangeInTax"?t.ChangeInTax=formatMoney(p.$value):p.$name=="CancelAmount"?t.CancelAmount=formatMoney(p.$value):p.$name=="ChangeInFee"&&(t.ChangeInFee=formatMoney(p.$value))}var d={PendingCancellationRescission:"rescission of pending cancellation",Reinstatement:"reinstatement",PendingCancellation:"pending cancellation",Cancellation:"cancellation"};if(t.params.pcsType=="PendingCancellationRescission"||t.params.pcsType=="Reinstatement")t.Undo=!0;t.PreviewLabel=d[t.params.pcsType],t.submitLabel=e.submitLabel,t.Action==="Pending Cancellation"?t.EffectiveDate=t.policy.InsurancePolicy.Management.PendingCancellation.$cancellationEffectiveDate:t.policy.InsurancePolicy.Management.PolicyState.$effectiveDate&&(t.EffectiveDate=t.policy.InsurancePolicy.Management.PolicyState.$effectiveDate),t.AdvanceNoticeDays=(Date.parse(t.EffectiveDate)-Date.parse(t.AppliedDate))/u,t.AdvanceNoticeDays<0&&(t.AdvanceNoticeDays=0),t.RateType=t.ReasonCode=="15"?"Short-Rate":"Pro Rata",$("#contents").html(ich[s](t)),$(".form_actions a").click(function(e){n.cancel()}),$("form").bind("submit",function(e){loadingOn($(this)),n.confirm()}),view.onReady()}}},view.cancel={vocabTerms:null,view:view.cancellation.actionView({context:view,viewName:"cancel"}),load:view.cancellation.actionLoad({pcsType:"Cancellation",title:"The policy has been cancelled"}),validators:{effectiveDate:view_validators.dateRange},preview:view.cancellation.preview({submitLabel:"Cancel this policy immediately"})},view.cancel_pending={vocabTerms:null,view:view.cancellation.actionView({context:view,viewName:"cancel_pending"}),load:view.cancellation.actionLoad({pcsType:"PendingCancellation",title:"The policy has been set to pending cancel"}),validators:{effectiveDate:view_validators.dateRange},preview:view.cancellation.preview({submitLabel:"Set to pending cancel"})},view.reinstate={vocabTerms:null,view:view.cancellation.actionView({context:view,viewName:"reinstate"}),load:view.cancellation.actionLoad({pcsType:"Reinstatement",title:"The policy has been reinstated"}),preview:view.cancellation.preview({submitLabel:"Reinstate this policy"})},view.rescind={vocabTerms:null,view:view.cancellation.actionView({context:view,viewName:"rescind"}),load:view.cancellation.actionLoad({pcsType:"PendingCancellationRescission",title:"The policy pending cancellation has been rescinded"}),preview:view.cancellation.preview({submitLabel:"Rescind pending cancellation"})},view.renew={vocabTerms:null,view:function(e,t){if(!e.policy)return e;var n=model.pxcentral.policy.getLastTerm(e.policy.InsurancePolicy),r=n.DataItem,i=mxAdmin.helpers.getDataItemValues(r,this.vocabTerms);return $.extend(!0,{},e,t,i)},load:function(e){if(!CTX.policy)return $.address.value(mxAdmin.homeAddress);var t=this,n=null,r=model.policy(CTX.policy.InsurancePolicy),i=null;e&&!mxAdmin.helpers.isEmpty(e)&&(e.transactionType="Renewal",e.effectiveDate="__deleteEmptyProperty",e.comment="__deleteEmptyProperty",e=$.extend(CTX.params||{},e),i=mxAdmin.helpers.getChangedDataItems(e,this.vocabTerms),i.length>0&&(model.transactionRequest.templates.renew.RenewalChanges={Set:{DataItem:i}}),CTX.currentPolicyTerms=t.getTermsForPreview(r),n=model.transactionRequest(CTX.policy).renew(e),e.preview?model.pxcentral.policy.set(r.id,n,{headers:{"X-Commit":!1},callback:function(n){var r=$.extend({},CTX);r.policy=n,delete e.preview,delete CTX.preview,CTX.params=e,r.params=e,t.preview(r)}}):model.pxcentral.policy.set(r.id,n,{callback:function(e){var t=model.policy(e.InsurancePolicy),n={};n.title="Policy "+CTX.policyId+" renewed successfully",n.desc=function(){var e="The policy was renewed for the term starting on <strong>",n=t.lastTerm,r=mxAdmin.helpers.cleanDate(n.EffectiveDate),i=mxAdmin.helpers.cleanDate(n.ExpirationDate);return e+=r+"</strong> and ending on <strong>"+i+"</strong>",e}(),view.request_success(n)()}}))},preview:function(e){var t=this,n=model.policy(e.policy.InsurancePolicy),r=null,i=null,s=null,o="renew-"+CTX.product;e.preview=!0,e.proposedTerm=t.getTermsForPreview(n,!0),e.previousTerms=CTX.currentPolicyTerms,r=e.proposedTerm[0],i=r.HurricanePremiumDollarAdjustmentFRC||0,s=r.NonHurricanePremiumDollarAdjustmentFRC||0,r.GrandSubtotalNonCatUnadjusted=(~~r.GrandSubtotalNonCat-~~s).formatMoney(1,".",""),r.GrandSubtotalCatUnadjusted=(~~r.GrandSubtotalCat-~~i).formatMoney(1,".",""),e.params.GrandSubtotalOverride&&(e.premiumOverride=!0,e.msg=!0,e.msgType="warning",e.msgHeading="A premium override has been applied",e.msgText="Values affected by the override are highlighted below."),$("#contents").html(ich[o](e)),view.onReady()},getTermsForPreview:function(e,t){var n=[],r=864e5,i={},s=null,o=null,u=null,a=null,f=0;t?u=[e.lastTerm]:u=e.terms,a=u.length;for(f;f<a;f+=1){s=Date.parse(mxAdmin.helpers.stripTimeFromDate(u[f].EffectiveDate)),o=Date.parse(mxAdmin.helpers.stripTimeFromDate(u[f].ExpirationDate)),i=mxAdmin.helpers.getDataItemValues(u[f].DataItem,this.vocabTerms);try{i.startDate=s.toString("MMM d yy"),i.endDate=o.toString("MMM d yy")}catch(l){console.log("Not able to convert the start and end dates to the proper format.",l)}i.days=Math.round((o-s)/r),i.HurricanePremiumDollarAdjustmentFRC===null&&(i.HurricanePremiumDollarAdjustmentFRC=0),i.NonHurricanePremiumDollarAdjustmentFRC===null&&(i.NonHurricanePremiumDollarAdjustmentFRC=0),n.push(i),i={}}return n}},view.endorse={vocabTerms:null,view:function(e,t){if(!e.policy)return e;var n=model.pxcentral.policy.getLastTerm(e.policy.InsurancePolicy),r=n.DataItem,i=mxAdmin.helpers.getDataItemValues(r,this.vocabTerms);return $.extend(!0,{},e,t,i)},load:function(e){if(!CTX.policy)return $.address.value(mxAdmin.homeAddress);if(e&&!mxAdmin.helpers.isEmpty(e)){var t=null,n=model.pxcentral.policy.id(CTX.policy),r=view.endorse,i=null;CTX.current_policy=view.endorse.parseIntervals(CTX),e.transactionType="Endorsement",e.comment===""&&(e.comment="__deleteEmptyProperty"),CTX.params&&(e=$.extend(!0,CTX.params,e)),i=mxAdmin.helpers.getChangedDataItems(e,this.vocabTerms),i.length>0&&(model.transactionRequest.templates.endorse.IntervalRequest.DataItem=i),t=model.transactionRequest(CTX.policy).endorse(e),e.preview?model.pxcentral.policy.set(n,t,{headers:{"X-Commit":!1},callback:function(t){var n=$.extend({},CTX);n.policy=t,delete e.preview,e.preview!=="re-preview"&&delete CTX.preview,CTX.params=e,n.params=e,r.preview(n)}}):model.pxcentral.policy.set(n,t)}},parseIntervals:function(e){var t={},n=model.pxcentral.policy.getLastTerm(e.policy.InsurancePolicy),r=n.Intervals&&n.Intervals.Interval,i,s,o,u,a,f,l,c,h,p,d=mxAdmin.helpers.getDataItem,v=864e5,m=0,g=0;try{m=e.params.NonHurricanePremiumDollarAdjustmentFRC||0,g=e.params.HurricanePremiumDollarAdjustmentFRC||0}catch(y){}r.length||(r=[r]),t.intervals=[],u=Date.parse(n.EffectiveDate),a=Date.parse(n.ExpirationDate),grandSubtotalNonCatUnadjusted=d(n.DataItem,"GrandSubtotalNonCatUnadjusted"),grandSubtotalCatUnadjusted=d(n.DataItem,"GrandSubtotalCatUnadjusted"),grandSubtotalNonCat=d(n.DataItem,"GrandSubtotalNonCat"),grandSubtotalCat=d(n.DataItem,"GrandSubtotalCat"),c=d(n.DataItem,"GrandSubtotalUnadjusted"),l=d(n.DataItem,"GrandSubtotal"),h=d(n.DataItem,"TermGrandSubtotalAdjustment"),f=d(n.DataItem,"TotalFees"),p=d(n.DataItem,"TotalPremium"),t.term={startDate:u,endDate:a,fmtStartDate:mxAdmin.helpers.cleanDate(n.EffectiveDate,"MMM d yy"),fmtEndDate:mxAdmin.helpers.cleanDate(n.ExpirationDate,"MMM d yy"),days:Math.round((a-u)/v),grandSubtotalNonCatUnadjusted:Math.round(grandSubtotalNonCatUnadjusted),grandSubtotalCatUnadjusted:Math.round(grandSubtotalCatUnadjusted),grandSubtotalNonCat:Math.round(grandSubtotalNonCat),grandSubtotalCat:Math.round(grandSubtotalCat),grandSubtotalUnadjusted:Math.round(c),termGrandSubtotalAdjustment:Math.round(h),grandSubtotal:Math.round(l),fees:Math.round(f),grandTotal:Math.round(p)};for(var b=0,w=r.length;b<w;b++)i=r[b],s=Date.parse(i.StartDate),o=Date.parse(i.EndDate),grandSubtotalNonCat=d(i.DataItem,"GrandSubtotalNonCat"),grandSubtotalCat=d(i.DataItem,"GrandSubtotalCat"),c=d(i.DataItem,"GrandSubtotalUnadjusted"),l=d(i.DataItem,"GrandSubtotal"),f=d(i.DataItem,"TotalFees"),p=d(i.DataItem,"TotalPremium"),t.intervals.push({startDate:s,endDate:s,fmtStartDate:mxAdmin.helpers.cleanDate(i.StartDate,"MMM d yy"),fmtEndDate:mxAdmin.helpers.cleanDate(i.EndDate,"MMM d yy"),days:Math.round((o-s)/v),grandSubtotalNonCatUnadjusted:Math.round(parseInt(grandSubtotalNonCat,10)-~~m),grandSubtotalCatUnadjusted:Math.round(parseInt(grandSubtotalCat,10)-~~g),nonCatAdjustment:m,catAdjustment:g,grandSubtotalNonCat:Math.round(grandSubtotalNonCat),grandSubtotalCat:Math.round(grandSubtotalCat),grandSubtotalUnadjusted:Math.round(c),grandSubtotal:Math.round(l),fees:Math.round(f),grandTotal:Math.round(p)});t.intervals.sort(function(e,t){var n=e.startDate,r=t.startDate;return n==r?0:n<r?-1:1}),t.intervals[t.intervals.length-1].isNew=!0;if(!t.term.grandSubTotal){i=t.intervals[t.intervals.length-1];for(b in i)Object.hasOwnProperty(i,b)&&(t[b]||(t[b]=i[b]))}return t},preview:function(e){var t="endorse-"+CTX.product;e.preview=view.endorse.parseIntervals(e),e.preview.current_policy=
CTX.current_policy,$("#contents").html(ich[t](e)),view.initPreview("#endorse"),view.onReady()}},view.change_customer={vocabTerms:null,view:function(e,t){if(!e.policy)return e;var n=model.policy(e.policy.InsurancePolicy),r=mxAdmin.helpers.getDataItemValues(n.insuredData,this.vocabTerms),i=model.pxcentral.policy.getLastTerm(e.policy.InsurancePolicy),s=i.DataItem;return $.extend(r,mxAdmin.helpers.getDataItemValues(s,this.vocabTerms)),r.MailingEqualPropertyAddress=="100"&&(r.DisableMailingAddress=!0),function(){var e=[],t=0,n={},i=3,s="",o=0,u=0,a=["AddressCity","AddressLine1","AddressLine2","AddressState","AddressZip","FirstName","LastName","ReferenceNumber","Type"],f=a.length;for(o;o<i;o+=1){u=0,t=o+1,s="AdditionalInsured"+t,n={number:t,itemPrefix:s};for(u;u<f;u+=1)n[a[u]]=r[s+a[u]],delete r[s+a[u]];e.push(n)}r.additionalInsured=e}(),$.extend(!0,{},e,t,r)},load:function(e){if(!CTX.policy)return $.address.value(HOME);$("#id_MailingEqualPropertyAddress").on("change",function(){$(this).val()=="100"?$("#id_InsuredMailingAddressLine1").parents("fieldset").first().hide():$("#id_InsuredMailingAddressLine1").parents("fieldset").first().show()}),$("#id_MailingEqualPropertyAddress, #id_PropertyStreetNumber, #id_PropertyStreetName, #id_PropertyAddressLine2, #id_PropertyCity, #id_PropertyState, #id_PropertyZipCode").on("change",function(){$("#id_MailingEqualPropertyAddress").val()=="100"&&($("#id_InsuredMailingAddressLine1").val($("#id_PropertyStreetNumber").val()+" "+$("#id_PropertyStreetName").val()),$("#id_InsuredMailingAddressLine2").val($("#id_PropertyAddressLine2").val()),$("#id_InsuredMailingAddressCity").val($("#id_PropertyCity").val()),$("#id_InsuredMailingAddressState").val($("#id_PropertyState").val()),$("#id_InsuredMailingAddressZip").val($("#id_PropertyZipCode").val()),$("#id_InsuredMailingAddressCountry").val(""))});if(e&&!mxAdmin.helpers.isEmpty(e)){var t=null,n=model.policy(CTX.policy.InsurancePolicy),r=null;e.transactionType="InsuredChanges",function(){var t=0,n=null,r=e.$changed.length;for(t;t<r;t+=1)n=e.$changed[t],e[n]===""&&(e[n]="__setEmptyValue")}(),r=mxAdmin.helpers.getChangedDataItems(e,this.vocabTerms),r.length>0&&(model.transactionRequest.templates.change_customer.CustomerChanges.Set.DataItem=r),t=model.transactionRequest(CTX.policy).change_customer(e),model.pxcentral.policy.set(n.id,t,{callback:function(e){var t={};t.title="Customer information changed for "+CTX.policyId,view.request_success(t)()}})}}},view.change_additional_interest={vocabTerms:null,view:function(e,t){if(!e.policy)return e;var n=model.policy(e.policy.InsurancePolicy),r=mxAdmin.helpers.getDataItemValues(n.additionalInterestData,this.vocabTerms);return $.extend(!0,{},e,t,r)},load:function(e){if(!CTX.policy)return $.address.value(mxAdmin.homeAddress);if(e&&!mxAdmin.helpers.isEmpty(e)){var t=null,n=model.policy(CTX.policy.InsurancePolicy),r=null;e.transactionType="AdditionalInterestChanges",function(){var t=0,n=null,r=e.$changed.length;for(t;t<r;t+=1)n=e.$changed[t],e[n]===""&&(e[n]="__setEmptyValue")}(),r=mxAdmin.helpers.getChangedDataItems(e,this.vocabTerms),r.length>0&&(model.transactionRequest.templates.change_additional_interest.CustomerChanges.Set.DataItem=r),t=model.transactionRequest(CTX.policy).change_additional_interest(e),model.pxcentral.policy.set(n.id,t,{callback:function(e){var t={};t.title="Additional Interest information changed for "+CTX.policyId,view.request_success(t)()}})}}},view.edit_term={load:function(e){if(!CTX.policy)return $.address.value(HOME);if(e&&!mxAdmin.helpers.isEmpty(e)){var t=null,n=model.pxcentral.policy.id(CTX.policy),r={};$.each(e,function(t,n){t.substr(0,4)==="name"&&n!==""&&(r[n]=e["new_"+t.split("_")[1]])}),Object.keys(r).length>0?(t=model.policyChangeSet(CTX.policy).edit_term(r),model.pxcentral.policy.set(n,t)):alert("no changed values found")}else{var i=model.policy(CTX.policy.InsurancePolicy),s=i.lastTerm,o=s.DataItem,u={};try{o.forEach(function(e){e.$value&&(u[e.$name]=e.$value)})}catch(a){console.log("view.js:view.edit_term.load() Having trouble iterating through intervalDI",a)}var f=$("#group_0").clone(!0),l=$(".form_actions")[0],c;f.attr("id",f.attr("id").slice(0,-1)).children("input").each(function(e){var t=$(this);t.attr("name",t.attr("name").slice(0,-1)).attr("id",t.attr("id").slice(0,-1))});function h(e){var t=f.clone(!0);return t.attr("id",f.attr("id")+e).children("input").each(function(t){var n=$(this);n.attr("name",n.attr("name")+e).attr("id",n.attr("id")+e)}),t}for(var p=1;p<5;p+=1)h(p).insertBefore(l);var d={source:Object.keys(u),minLength:2},v=function(e){var t=$(this),n=t.val();n in u&&(t.siblings("input[name^=current]").val(u[n]),p===+t.attr("id").slice(-1)+1&&(h(p).insertBefore(l),p++,$("input[name^=name]",".content_body").autocomplete(d)))};$(".content_body").delegate("input[name^=name]","keyup",v).delegate("input[name^=name]","blur",v),$("input[name^=name]",".content_body").autocomplete(d)}}},view.generate_document={vocabTerms:null,view:function(e,t){if(!e.policy)return e;var n={documentGroups:this.vocabTerms};return $("input[type=submit]").live("click",function(e){$("input[name=documentType]").val($(this).attr("name")),$("input[name=documentLabel]").val($(this).val())}),$.extend(!0,{},e,t,n)},load:function(e){if(!CTX.policy)return $.address.value(HOME);if(e&&!mxAdmin.helpers.isEmpty(e)){var t=new Date,n=t.toISOString().replace(/:|\.\d{3}/g,""),r=t.toString("M/d/yy"),i=["ReissueDeclarationPackage","Invoice"],s={},o=null,u="generate_document-"+CTX.product;s.generating=!0,s.documentLabel=e.documentLabel,s.policyId=CTX.policyId,$("#contents").html(ich[u](s)),e.user=CTX.user,e.documentId=e.documentType+"-"+n,$.inArray(e.documentType,i)!==-1&&(e.documentLabel=e.documentLabel+" "+r),o=model.policyChangeSet(CTX.policy).generate_document(e),model.pxcentral.policy.set(model.pxcentral.policy.id(CTX.policy),o)}}},view.premium_disbursement={load:function(e){var t=model.pxcentral.policy.id(CTX.policy),n=model.ixlibrary.policy.url(t),r=null;if(!CTX.policy)return $.address.value(HOME);e&&!mxAdmin.helpers.isEmpty(e)&&(e.amount=Math.abs(e.amount||0),r=model.policyChangeSet(CTX.policy).premium_disbursement(e),model.pxcentral.policy.set(t,r))}},view.reverse_disbursement={load:function(e){var t=model.pxcentral.policy.id(CTX.policy),n=model.ixlibrary.policy.url(t),r=null;if(!CTX.policy)return $.address.value(HOME);e&&!mxAdmin.helpers.isEmpty(e)&&(e.amount=Math.abs(e.amount||0),r=model.policyChangeSet(CTX.policy).reverse_disbursement(e),model.pxcentral.policy.set(t,r))}},view.change_payment_plan={load:function(e){if(!CTX.policy)return $.address.value(mxAdmin.homeAddress);var t=model.policy(CTX.policy.InsurancePolicy),n=null;e&&!mxAdmin.helpers.isEmpty(e)&&(e.startDate=t.lastInterval.StartDate,e.endDate=t.lastInterval.EndDate,n=model.policyChangeSet(CTX.policy).change_payment_plan(e),model.pxcentral.policy.set(t.id,n))}},view.update_mortgagee={vocabTerms:null,view:function(e,t,n){if(!e.policy)return e;var r=model.policy(e.policy.InsurancePolicy),i=mxAdmin.helpers.getDataItemValues(r.mortgageeData,this.vocabTerms);return $.extend(!0,{},e,t,i)},load:function(e){if(!CTX.policy)return $.address.value(HOME);if(e&&!mxAdmin.helpers.isEmpty(e)){var t=null,n=model.policy(CTX.policy.InsurancePolicy),r=null;e.transactionType="MortgageeChanges",function(){var t=0,n=null,r=e.$changed.length;for(t;t<r;t+=1)n=e.$changed[t],e[n]===""&&(e[n]="__setEmptyValue")}(),r=mxAdmin.helpers.getChangedDataItems(e,this.vocabTerms),r.length>0&&(model.transactionRequest.templates.update_mortgagee.CustomerChanges.Set.DataItem=r),t=model.transactionRequest(CTX.policy).update_mortgagee(e),model.pxcentral.policy.set(n.id,t,{callback:function(e){var t={};t.title="Mortgagee updated for "+CTX.policyId,view.request_success(t)()}})}}},view.update_risk={load:function(e){var t=null,n=null;if(!CTX.policy)return $.address.value(HOME);e&&!mxAdmin.helpers.isEmpty(e)&&(t=model.pxcentral.policy.id(CTX.policy),n=model.policyChangeSet(CTX.policy).update_risk(e),model.pxcentral.policy.set(t,n))}},view.apply_charges={vocabTerms:null,view:function(e,t){if(!e.policy)return e;var n=model.pxcentral.policy.getLastTerm(e.policy.InsurancePolicy),r=n.DataItem,i=mxAdmin.helpers.getDataItemValues(r,this.vocabTerms);return $.extend(!0,{},e,t,i)},load:function(e){var t=null,n=null;if(!CTX.policy)return $.address.value(HOME);e&&!mxAdmin.helpers.isEmpty(e)&&(t=model.pxcentral.policy.id(CTX.policy),e.amount=Math.abs(e.amount||0),e.reasonCodeLabel=$("#id_reasonCode option[value="+e.reasonCode+"]").html(),e.lineItemType=e.reasonCodeLabel.toUpperCase().replace(/ /g,"_"),n=model.policyChangeSet(CTX.policy).apply_charges(e),model.pxcentral.policy.set(t,n))}},view.write_off={vocabTerms:null,view:function(e,t){if(!e.policy)return e;var n=model.pxcentral.policy.getLastTerm(e.policy.InsurancePolicy),r=n.DataItem,i=mxAdmin.helpers.getDataItemValues(r,this.vocabTerms);return $.extend(!0,{},e,t,i)},load:function(e){var t=null,n=null;if(!CTX.policy)return $.address.value(HOME);e&&!mxAdmin.helpers.isEmpty(e)&&(t=model.pxcentral.policy.id(CTX.policy),e.amount=Math.abs(e.amount||0),e.reasonCodeLabel=$("#id_reasonCode option[value="+e.reasonCode+"]").html(),n=model.policyChangeSet(CTX.policy).write_off(e),model.pxcentral.policy.set(t,n))}};var model={};model.GET=function(e,t,n){var r=_preflight_credentials();if(!r)return;return $.ajax({url:e,dataType:"xml",beforeSend:com.ics360.ajaxCrippledClient("GET",["X-Authorization: Basic "+r,"Cache-Control: no-cache"]),error:n,success:function(e,r,i){var s=com.ics360.ajaxCrippleClientSuccess(i);s?e&&t(objectify.fromXML(e)):n(i,r)}})},model.DELETE=function(e,t,n){var r=_preflight_credentials();if(!r)return;return console.log("DELETE "+e),$.ajax({url:e,dataType:"xml",beforeSend:com.ics360.ajaxCrippledClient("DELETE",["X-Authorization: Basic "+r]),error:n,success:function(e,r,i){var s=com.ics360.ajaxCrippleClientSuccess(i);s?e&&t(objectify.fromXML(e)):n(i,r)}})},model._UP=function(e){return function(t,n,r){var i=_preflight_credentials(),s=null,o={contentType:"application/xml",success:function(){alert("Success")},error:function(e,t){alert("Error "+t)},headers:{"X-Authorization":"Basic "+i}},u=[];s=$.extend(!0,o,r),$.each(s.headers,function(e,t){u.push(e+": "+t)});if(!i)return;return $.ajax({url:t,dataType:"xml",type:"POST",contentType:s.contentType,data:objectify.toXML(n),beforeSend:com.ics360.ajaxCrippledClient(e,u),error:view.message,success:function(e,t,n){var r=com.ics360.ajaxCrippleClientSuccess(n);r?e&&s.success(objectify.fromXML(e)):s.error(n,t)}})}},model.POST=model._UP("POST"),model.PUT=model._UP("PUT"),model.mime={bmp:"images/bmp",css:"text/css",doc:"application/msword",dot:"application/msword",gif:"image/gif",gz:"application/x-gzip",htm:"text/html",html:"text/html",ico:"image/x-icon",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/javascript",mht:"message/rfc822",mhtml:"message/rfc822",pdf:"application/pdf",png:"image/png",pps:"application/vnd.ms-powerpoint",ppt:"application/vnd.ms-powerpoint",svg:"image/svg+xml",tgz:"application/x-compressed",txt:"text/plain",xla:"application/vnd.ms-excel",xlc:"application/vnd.ms-excel",xlm:"application/vnd.ms-excel",xls:"application/vnd.ms-excel",xlt:"application/vnd.ms-excel",xlw:"application/vnd.ms-excel",zip:"application/zip"},model.mimeFromExt=function(e){return model.mime[e.toLowerCase()]||"application/octet-stream"},model.login=function(){return $(document).bind("com.ics360.error",function(e){e.stopPropagation(),e.preventDefault(),view.login.error()}),function(e,t,n){com.ics360.ixdirectory.loadIdentity(e,t,function(){cookie.set("mxadmin.login",com.ics360.ixdirectory.getAuthorizationHash(),14),n&&typeof n=="function"&&n(com.ics360.ixdirectory.getUserEmail())})}}(),model.policy=function(e){var t=this,n=model.pxcentral.policy,r={};return this.policyXML=e,this.states={ACTIVE_POLICY:"ACTIVEPOLICY",ACTIVE_QUOTE:"ACTIVEQUOTE",CANCELLED_POLICY:"CANCELLEDPOLICY",EXPIRED_QUOTE:"EXPIREDQUOTE",NON_RENEWED_POLICY:"NONRENEWEDPOLICY"},this.state=function(){var e=t.policyXML.Management,n=e.PolicyState,r=null;return typeof n=="string"?r=n:r=n.$,r},this.cancelled=function(e){var n=!1,r=t.state();return r==="CANCELLEDPOLICY"&&(n=!0),n},this.quote=function(){var e=t.state();return e===t.states.ACTIVE_QUOTE||e===t.states.EXPIRED_QUOTE},this.pendingCancel=function(e){var n=t.policyXML.Management,r=n.PendingCancellation||!1;return e&&r&&(r=!0),r},this.cancellationEffectiveDate=function(){var e=t.state(),n=null,r=null;switch(e){case"ACTIVEPOLICY":r=t.pendingCancel(),r&&(n=r.$cancellationEffectiveDate);break;case"CANCELLEDPOLICY":n=t.policyXML.Management.PolicyState.$effectiveDate}return n},this.cancellationReasonCode=function(){var e=t.state(),n=null,r=t.pendingCancel();switch(e){case"ACTIVEPOLICY":r=t.pendingCancel(),r&&(n=r.$reasonCode);break;case"CANCELLEDPOLICY":n=t.policyXML.Management.PolicyState.$reasonCode}return n},this.terms=function(){var e=[],n=t.policyXML.Terms.Term;return $.isArray(n)?e=n:e.push(n),e},this.lastTerm=function(){var e=this.terms();return l=e.length,e[l-1]},this.customerData=function(e){var n=null,r=t.policyXML.Customers.Customer,i=0,s=r.length;for(i;i<s;i+=1)if(r[i].$type===e){n=r[i].DataItem;break}return n},this.intervalsOfTerm=function(e){var t=[],n=e.Intervals.Interval;return $.isArray(n)?t=n:t.push(n),t},this.lastInterval=function(){var e=this.lastTerm();return intervals=this.intervalsOfTerm(e),l=intervals.length,intervals[l-1]},r.orig=e,r.state=this.state(),r.quote=this.quote(),r.quote?r:(r.pendingCancel=this.pendingCancel(!0),r.cancellationEffectiveDate=this.cancellationEffectiveDate(),r.cancellationReasonCode=this.cancellationReasonCode(),r.cancelled=this.cancelled(),r.terms=this.terms(),r.lastInterval=this.lastInterval(),r.insuredData=this.customerData("Insured"),r.mortgageeData=this.customerData("Mortgagee"),r.additionalInterestData=this.customerData("AdditionalInterest"),r.productName=function(){var e=null,n=mxAdmin.helpers.getDataItem,r=t.lastTerm(),i=r.DataItem,s=[n(i,"OpProgram"),n(i,"OpPolicyType"),n(i,"OpPropertyState")];return e=s.join("-").toLowerCase(),e}(),r.id=n.id(t.policyXML),r.issued=n.isIssued(t.policyXML),r.firstTerm=n.getFirstTerm(t.policyXML),r.lastTerm=n.getLastTerm(t.policyXML),r.effectiveDate=n.getEffectiveDate(t.policyXML),r.expirationDate=n.getExpirationDate(t.policyXML),r)},model.pxcentral={init:function(e){this._url=e,e[e.length-1]!=="/"&&(this._url+="/")},policy:{id:function(e){return e?_itemGet((e.InsurancePolicy||e).Identifiers.Identifier,"InsightPolicyId"):null},get:function(e,t,n){var r=model.pxcentral._url+"policies/"+e;return r+="?media=insurancepolicy.2.6",model.GET(r,t,n)},set:function(e,t,n){var r={contentType:"application/xml;",url:model.pxcentral._url+"policies/"+e,headers:{Accept:"application/vnd.ics360.insurancepolicy.2.6+xml","X-Commit":!0},callback:view.request_success(),err:view.request_error},i=null,s=t.__rootName.toLowerCase(),o=t.$schemaVersion,u=" schema="+s+"."+o;return r.contentType=r.contentType+u,i=$.extend(!0,r,n),model.POST(i.url,t,{contentType:i.contentType,headers:i.headers,success:i.callback,error:i.err})},isIssued:function(e){if(e.History&&e.History.Event)for(var t=0,n=e.History.Event.length;t<n;t++)if(e.History.Event[t].$type.toLowerCase().indexOf("issue")===0)return!0;return!1},getTerm:function(e,t){var n=e.Terms.Term,r=t-1,i=this.getNumberOfTerms(e),s=null;if(i>1){try{if(t>i)throw new Error}catch(o){r=0,console.error("Term number "+t+" was requested, but the policy only contains "+i+" terms. Term 1 has been returned.")}s=n[r]}else{try{if(r>0)throw new Error}catch(o){console.error("Term number "+t+" was requested, but the policy only contains 1 term.")}s=n}return s},getFirstTerm:function(e){return this.getTerm(e,1)},getLastTerm:function(e){var t=this.getNumberOfTerms(e);return this.getTerm(e,t)},getNumberOfTerms:function(e){var t=e.Terms.Term,n=jQuery.isArray(t),r=null;return n?r=t.length:r=1,r},getTermDate:function(e,t){var n,r;switch(t){case"effective":n=this.getFirstTerm(e),r=n.EffectiveDate;break;case"expiration":n=this.getLastTerm(e),r=n.ExpirationDate;break;default:throw new Error(t+" is not a recognized date type.")}return r=mxAdmin.helpers.stripTimeFromDate(r),Date.parse(r).toString("yyyy-MM-dd")},getEffectiveDate:function(e){return this.getTermDate(e,"effective")},getExpirationDate:function(e){return this.getTermDate(e,"expiration")}}},model.ixdoc={init:function(e){model.ixdoc._url=e,e[e.length-1]!=="/"&&(this._url+="/"),model.ixdoc._url+="templates/"},template:function(e,t,n,r,i){var s=_preflight_credentials();if(!IXDOC_PDF_TEMPLATES[e])throw new Error('template key "'+e.toString()+'" is not in IXDOC_PDF_TEMPLATES');$.ajax({url:model.ixdoc._url+IXDOC_PDF_TEMPLATES[e]+i,type:"POST",contentType:"application/xml",data:t,beforeSend:function(t){t.setRequestHeader("X-Authorization","Basic "+s),t.setRequestHeader("X-Storage-Location","http://ics-test-services.arc/cru-4"+model.ixlibrary.policy.url(model.pxcentral.policy.id(CTX.policy),e))},error:r,success:function(e,t,i){i.status===201?n.call(this,i.getResponseHeader("Location")):r.call(this,i)}})}},model.ixlibrary={init:function(e){model.ixlibrary._url=e,e[e.length-1]!=="/"&&(this._url+="/"),model.ixlibrary._url+="buckets/"},policy:{url:function(e,t){return model.ixlibrary._url+"policy_"+e+"/objects"+(t?"/"+t:"")},get:function(e,t,n,r){return typeof t=="function"&&(r=n,n=t,t=null),model.GET(this.url(e,t),function(e){!e||e.Error?r&&r.call&&r(e):n&&n.call&&n(e)},r)},set:function(e,t,n,r,i){return typeof t=="function"&&(i=r,r=t,t=null),model.PUT(this.url(e,t),r,i)},bindField:function(e,t,n,r){var i=_preflight_credentials(),s;if(!i)return;t+="?x-crippled-client=true&x-crippled-client-envelope=true";try{s=new AjaxUpload(e,{action:t,name:"object-data-file",responseType:!1,data:{name:e,"auth-token":"Basic "+i,"object-key":n,"content-type":"application/octet-stream"},onChange:function(t,n){$(e+">.filename").text(t),$(e+">.action").text("Uploading..."),s._settings.data["content-type"]=model.mimeFromExt(n)},onSubmit:function(e,t){this.disable(),$("input[type=submit]").attr("disabled",!0)},onComplete:function(n,i){var s=i.firstChild,o=~~s.getAttribute("statusCode"),u=s.getAttribute("statusText");o>=400?($("body").trigger("error",["Upload Error: "+o+" "+u,'Form submission disabled. Try again or check the <a href="'+t.split("?")[0]+'">ixLibrary Bucket</a>.']),$(e+">.action").text("Choose File"),this.enable()):($(e).find(".action").text("Uploaded"),$("input[type=submit]").removeAttr("disabled"),r.apply(this,arguments))}})}catch(o){}}},slugs:{issue:{objKey:"PolicyNewBusinessPackage",docId:"PolicyNewBusinessPackage",decKey:"DeclarationofCoverage",decId:"DeclarationofCoverage"},invoice:{objKey:"PolicyInvoice",docId:"PolicyInvoice"},cancel:{objKey:"CancelNotice",docId:"CancelNotice"},pendingCancel:{objKey:"PendingCancelNotice",docId:"PendingCancelNotice"},rescind:{objKey:"RescindPendingCancelNotice",docId:"RescindPendingCancelNotice"},reinstate:{objKey:"ReinstateNotice",docId:"ReinstateNotice"}}},model.changeSpec=function(e,t){var n={};for(var r in t){if(r==="_skeleton"||r==="context")continue;n[r]=function(n){return function(r){var i=t.context(e,r,n),s=$.extend(!0,{},t._skeleton,t[n]);return model.changeSpecReplacement(s,i)}}(r)}return n},model.changeSpecReplacement=function(e,t){function r(e){return(e.toString()||"").replace(/\{\{\s*(\S+)\s*\}\}/g,function(e,n){return t[n]||""})}var n;for(var i in e){if(i.slice(0,2)==="__")continue;if(typeof e[i]=="object")if(e[i].length>0)for(var s=0,o=e[i].length;s<o;s++){if(e[i][s].hasOwnProperty("__test")){n=r(e[i][s].__test);if(!n){delete e[i][s];continue}}e[i][s]=model.changeSpecReplacement(e[i][s],t)}else{if(e[i].hasOwnProperty("__test")){n=r(e[i].__test);if(!n){delete e[i];continue}}e[i]=model.changeSpecReplacement(e[i],t)}else e[i]=r(e[i]),e[i]==="__deleteEmptyProperty"&&delete e[i],e[i]==="__setEmptyValue"&&(e[i]="")}return e},model.policyChangeSet=function(e){var t=null,n=model.policyChangeSet.templates;return t=model.changeSpec(e,n),t.edit_term=function(t){var r=model.policy(e.InsurancePolicy),i=[],s=n.context(e,{},"edit_term"),o,u=r.lastTerm.EffectiveDate,a=r.lastTerm.ExpirationDate;for(var f in t)t.hasOwnProperty(f)&&i.push({$name:f,$value:t[f]});return o=$.extend(!0,{},model.policyChangeSet.templates._skeleton,{Terms:{Term:{EffectiveDate:u,ExpirationDate:a,Changes:{Set:{DataItem:i}}}},EventHistory:{Event:{$type:"DataCorrection",DataItem:i}}}),model.changeSpecReplacement(o,s)},t},model.transactionRequest=function(e){var t=null,n=model.transactionRequest.templates;return t=model.changeSpec(e,n),t},model.transactionRequest.templates={_skeleton:{__rootName:"TransactionRequest",$schemaVersion:"1.4",Initiation:{Initiator:{$type:"user",$:"{{user}}"}},Target:{Identifiers:{Identifier:{$name:"InsightPolicyId",$value:"{{id}}"}},SourceVersion:"{{version}}"},EffectiveDate:"{{effectiveDate}}"},cancellation:{$type:"{{pcsType}}",ReasonCode:"{{reasonCode}}",Comment:"{{comment}}"},endorse:{$type:"{{transactionType}}",ReasonCode:"{{reasonCode}}",Comment:"{{comment}}",IntervalRequest:{StartDate:"{{effectiveDate}}"}},change_customer:{$type:"{{transactionType}}",ReasonCode:"{{reasonCode}}",CustomerChanges:{Set:{}}},change_additional_interest:{$type:"{{transactionType}}",ReasonCode:"{{reasonCode}}",CustomerChanges:{Set:{}}},issue:{$type:"{{transactionType}}",AppliedDate:"__deleteEmptyProperty"},renew:{$type:"{{transactionType}}",Comment:"{{comment}}"},update_mortgagee:{$type:"{{transactionType}}",ReasonCode:"53",CustomerChanges:{Set:{}}},context:function(e,t,n){var r=e.InsurancePolicy||e,i=_itemGet(r.Identifiers.Identifier,"InsightPolicyId"),s,o;for(o in t)t.hasOwnProperty(o)&&o.indexOf("Date")>=0&&t[o]&&t[o]!=="__deleteEmptyProperty"&&(t[o]=Date.parse(t[o]).toString("yyyy-MM-dd"));return $.extend(!0,t,{user:CTX.user,id:i,version:r.Management.Version,timestamp:t.timestamp||(new Date).toISOString(),datestamp:Date.today().toString("MM/dd/yy"),effectiveDate:t.effectiveDate||Date.today().toString("yyyy-MM-dd"),comment:t.comment||""})}},model.policyChangeSet.templates={_skeleton:{__rootName:"PolicyChangeSet",$schemaVersion:"3.1",Initiation:{Initiator:{$type:"user",$:"{{user}}"}},Target:{Identifiers:{Identifier:{$name:"InsightPolicyId",$value:"{{ id }}"}},SourceVersion:"{{ version }}"},EffectiveDate:"{{ effectiveDate }}",AppliedDate:"{{ appliedDate }}",Comment:"{{ comment }}"},apply_charges:{Ledger:{LineItem:{$value:"{{amount}}",$type:"{{lineItemType}}",$timestamp:"{{timestamp}}",Memo:{$:""}}},EventHistory:{Event:{$type:"ChargeApplied",DataItem:[{$name:"Amount",$value:"{{amount}}"},{$name:"ReasonCode",$value:"{{reasonCode}}"},{$name:"ReasonCodeLabel",$value:"{{reasonCodeLabel}}"}]}}},issue_manual:{DocumentChanges:{Set:{DocumentRef:[{$type:model.ixlibrary.slugs.issue.docId,$label:"Policy New Business Package",$href:"{{packageDocUrl}}",$id:model.ixlibrary.slugs.issue.docId+"-{{idtimestamp}}"},{__test:"{{declarationDoc}}",$type:model.ixlibrary.slugs.issue.decId,$label:"Declaration of Coverage {{formattedMDY}}",$href:"{{declarationDocUrl}}",$id:"DeclarationOfCoverage-{{idtimestamp}}"}]}},EventHistory:{Event:{$type:"Issue"}}},invoice:{DocumentChanges:{Set:{DocumentRef:{$type:"{{documentType}}",$label:"{{documentLabel}}",$href:"{{documentHref}}",$id:"{{documentId}}"}}},Ledger:{__test:"{{installmentCharge}}",LineItem:{$value:"{{installmentCharge}}",$type:"INSTALLMENT_CHARGE",$timestamp:"{{timestamp}}",Memo:{$:""}}},AccountingChanges:{Set:{DataItem:[{$name:"InvoiceAmountCurrent",$value:"{{InvoiceAmountCurrent}}"},{$name:"InvoiceDateCurrent",$value:"{{InvoiceDateCurrent}}"},{$name:"InvoiceDateDueCurrent",$value:"{{InvoiceDateDueCurrent}}"}]}},EventHistory:{Event:{$type:"Invoice",DataItem:[{$name:"InvoiceAmountCurrent",$value:"{{InvoiceAmountCurrent}}"},{$name:"InvoiceDateCurrent",$value:"{{InvoiceDateCurrent}}"},{$name:"InvoiceDateDueCurrent",$value:"{{InvoiceDateDueCurrent}}"}]}}},make_payment:{Ledger:{LineItem:{$value:"{{paymentAmount}}",$type:"PAYMENT",$timestamp:"{{timestamp}}",Memo:"",DataItem:[{$name:"Reference",$value:"{{paymentReference}}"},{$name:"PaymentMethod",$value:"{{paymentMethod}}"}]}},EventHistory:{Event:{$type:"Payment",DataItem:[{$name:"PaymentAmount",$value:"{{positivePaymentAmount}}"},{$name:"PaymentMethod",$value:"{{paymentMethod}}"},{$name:"PaymentReference",$value:"{{paymentReference}}"},{$name:"PaymentBatch",$value:"{{paymentBatch}}"},{$name:"PostmarkDate",$value:"{{postmarkDate}}"},{$name:"AppliedDate",$value:"{{appliedDate}}"}]}}},generate_document:{DocumentChanges:{Set:{DocumentRef:{$type:"{{documentType}}",$label:"{{documentLabel}}",$href:"{{documentHref}}",$id:"{{documentId}}"}}}},premium_disbursement:{Ledger:{LineItem:{$value:"{{amount}}",$type:"DISBURSE",$timestamp:"{{timestamp}}",Memo:"Return Premium",DataItem:[{$name:"Amount",$value:"{{amount}}"},{$name:"Reference",$value:"{{reference}}"}]}},EventHistory:{Event:{$type:"ReturnPremium",DataItem:[{$name:"Amount",$value:"{{amount}}"},{$name:"Reference",$value:"{{reference}}"}]}}},reverse_disbursement:{Ledger:{LineItem:{$value:"-{{amount}}",$type:"REVERSE_DISBURSE",$timestamp:"{{timestamp}}",Memo:{$:""},DataItem:[{$name:"Amount",$value:"{{amount}}"},{$name:"Reference",$value:"{{reference}}"}]}},EventHistory:{Event:{$type:"VoidStopPay",DataItem:[{$name:"Amount",$value:"{{amount}}"},{$name:"Reference",$value:"{{reference}}"}]}}},reverse_payment:{Ledger:{LineItem:{$value:"{{paymentAmount}}",$type:"REVERSE_PAYMENT",$timestamp:"{{timestamp}}",Memo:{$:""},DataItem:[{$name:"Reference",$value:"{{paymentReference}}"},{$name:"PaymentMethod",$value:"{{paymentMethod}}"}]}},EventHistory:{Event:{$type:"Chargeback",DataItem:[{$name:"Amount",$value:"{{paymentAmount}}"},{$name:"Reference",$value:"{{paymentReference}}"},{$name:"PaymentMethod",$value:"{{paymentMethod}}"}]}}},change_payment_plan:{Intervals:{Interval:{StartDate:"{{startDate}}",EndDate:"{{endDate}}",Changes:{Set:{DataItem:[{$name:"OpPaymentPlanType",$value:"{{paymentPlanType}}"},{$name:"PaymentPlanType",$value:"{{paymentPlanType}}"}]}}}},PaymentPlan:{$type:"{{paymentPlanType}}",Installments:{}},EventHistory:{Event:{$type:"Endorse",DataItem:[{$name:"reasonCode",$value:"155"},{$name:"reasonCodeLabel",$value:"Change Payment Plan"},{$name:"AppliedDate",$value:"{{appliedDate}}"},{$name:"OpPaymentPlanType",$value:"{{paymentPlanType}}"},{$name:"PaymentPlanType",$value:"{{paymentPlanType}}"}]}}},update_risk:{Intervals:{Interval:{StartDate:"{{appliedDate}}",DataItem:[{$name:"SquareFootUnderRoof",$value:"{{squareFootUnderRoof}}"},{$name:"ReplacementCostBuilding",$value:"{{replacementCostBuilding}}"}]}},EventHistory:{Event:{$type:"Endorse",DataItem:[{$name:"AppliedDate",$value:"{{appliedDate}}"},{$name:"EffectiveDate",$value:"{{effectiveDate}}"},{$name:"reasonCode",$value:"85"},{$name:"reasonCodeLabel",$value:"Change Rating Characteristics Based On Physical Inspection"},{$name:"SquareFootUnderRoof",$value:"{{squareFootUnderRoof}}"},{$name:"ReplacementCostBuilding",$value:"{{replacementCostBuilding}}"}]}}},write_off:{Ledger:{LineItem:{$value:"-{{amount}}",$type:"WRITE_OFF_CHARGE",$timestamp:"{{timestamp}}",Memo:"Installment Charge",DataItem:[{$name:"Reference",$value:"{{reasonCodeLabel}}"}]}},EventHistory:{Event:{$type:"WriteOffCharge",DataItem:[{$name:"Amount",$value:"{{amount}}"},{$name:"Reference",$value:"{{reasonCodeLabel}}"}]}}},context:function(e,t,n){var r=e.InsurancePolicy||e,i=_itemGet(r.Identifiers.Identifier,"InsightPolicyId"),s,o;for(o in t)if(t.hasOwnProperty(o))if(o.indexOf("Doc")>=0)try{t[o+"Url"]=IXLIB_BASE+model.ixlibrary.policy.url(i,t[o]).replace(/(\/)?ixlibrary(\/)?/,"")}catch(u){}else o.indexOf("Date")>=0&&t[o]&&(t[o]=Date.parse(t[o].replace(".000Z","Z")).toISOString());return $.extend(!0,t,{user:CTX.user,id:i,version:r.Management.Version,timestamp:t.timestamp||(new Date).toISOString(),datestamp:Date.today().toString("MM/dd/yy"),effectiveDate:t.effectiveDate||Date.today().toISOString(),appliedDate:t.appliedDate||Date.today().toISOString(),comment:t.comment||"posted by mxAdmin"})}};