// Generated by CoffeeScript 1.4.0
(function() {

  define(['jquery', 'underscore', 'backbone'], function($, _, Backbone) {
    var JSONAuthSync, originalSync;
    originalSync = Backbone.sync;
    return JSONAuthSync = function(method, model, options) {
      var methodMap, type;
      methodMap = {
        'create': 'POST',
        'update': 'PUT',
        'delete': 'DELETE',
        'read': 'GET'
      };
      type = methodMap[method];
      options = _.extend(options, {
        withCredentials: true
      });
      if (model.get('digest') != null) {
        options.basic_auth_digest = model.get('digest');
      }
      options.beforeSend = function(xhr) {
        xhr.setRequestHeader('X-Requested-With', 'XMLHTTPRequest');
        if (options.basic_auth_digest) {
          xhr.setRequestHeader('X-Authorization', "Basic " + options.basic_auth_digest);
          return xhr.setRequestHeader('Authorization', "Basic " + options.basic_auth_digest);
        }
      };
      return originalSync.apply(Backbone, [method, model, options]);
    };
  });

}).call(this);
