<!DOCTYPE html>  <html> <head>   <title>PolicyView.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="IPMActionView.html">                 IPMActionView.coffee               </a>                                           <a class="source" href="IPMChangeSet.html">                 IPMChangeSet.coffee               </a>                                           <a class="source" href="IPMFormValidation.html">                 IPMFormValidation.coffee               </a>                                           <a class="source" href="IPMModule.html">                 IPMModule.coffee               </a>                                           <a class="source" href="IPMView.html">                 IPMView.coffee               </a>                                           <a class="source" href="PolicyModel.html">                 PolicyModel.coffee               </a>                                           <a class="source" href="PolicyModule.html">                 PolicyModule.coffee               </a>                                           <a class="source" href="PolicyView.html">                 PolicyView.coffee               </a>                                           <a class="source" href="ReferralAssigneesModel.html">                 ReferralAssigneesModel.coffee               </a>                                           <a class="source" href="ReferralQueueModule.html">                 ReferralQueueModule.coffee               </a>                                           <a class="source" href="ReferralQueueView.html">                 ReferralQueueView.coffee               </a>                                           <a class="source" href="ReferralTaskCollection.html">                 ReferralTaskCollection.coffee               </a>                                           <a class="source" href="ReferralTaskModel.html">                 ReferralTaskModel.coffee               </a>                                           <a class="source" href="ReferralTaskView.html">                 ReferralTaskView.coffee               </a>                                           <a class="source" href="RenewalUnderwritingModel.html">                 RenewalUnderwritingModel.coffee               </a>                                           <a class="source" href="RenewalUnderwritingView.html">                 RenewalUnderwritingView.coffee               </a>                                           <a class="source" href="SearchContextCollection.html">                 SearchContextCollection.coffee               </a>                                           <a class="source" href="SearchContextModel.html">                 SearchContextModel.coffee               </a>                                           <a class="source" href="SearchContextView.html">                 SearchContextView.coffee               </a>                                           <a class="source" href="SearchModule.html">                 SearchModule.coffee               </a>                                           <a class="source" href="SearchPolicyCollection.html">                 SearchPolicyCollection.coffee               </a>                                           <a class="source" href="SearchPolicyModel.html">                 SearchPolicyModel.coffee               </a>                                           <a class="source" href="SearchPolicyView.html">                 SearchPolicyView.coffee               </a>                                           <a class="source" href="SearchView.html">                 SearchView.coffee               </a>                                           <a class="source" href="ZenDeskView.html">                 ZenDeskView.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               PolicyView.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="nx">define</span> <span class="p">[</span>
  <span class="s">&#39;BaseView&#39;</span><span class="p">,</span>
  <span class="s">&#39;Messenger&#39;</span><span class="p">,</span>
  <span class="s">&#39;base64&#39;</span><span class="p">,</span>
  <span class="s">&#39;modules/RenewalUnderwriting/RenewalUnderwritingView&#39;</span><span class="p">,</span>
  <span class="s">&#39;swfobject&#39;</span><span class="p">,</span>
  <span class="s">&#39;text!modules/Policy/templates/tpl_policy_container.html&#39;</span><span class="p">,</span>
  <span class="s">&#39;text!modules/Policy/templates/tpl_policy_error.html&#39;</span><span class="p">,</span>
  <span class="s">&#39;text!modules/Policy/templates/tpl_ipm_header.html&#39;</span><span class="p">,</span>
  <span class="s">&#39;text!modules/RenewalUnderwriting/templates/tpl_renewal_underwriting_wrapper.html&#39;</span><span class="p">,</span>
  <span class="s">&#39;modules/IPM/IPMModule&#39;</span><span class="p">,</span>
  <span class="s">&#39;modules/ZenDesk/ZenDeskView&#39;</span>
<span class="p">],</span> <span class="nf">(BaseView, Messenger, Base64, RenewalUnderwritingView, swfobject, tpl_policy_container, tpl_policy_error, tpl_ipm_header, tpl_ru_wrapper, IPMModule, ZenDeskView) -&gt;</span>

  <span class="nv">PolicyView = </span><span class="nx">BaseView</span><span class="p">.</span><span class="nx">extend</span>

    <span class="nv">events : </span>
      <span class="s">&quot;click .policy-nav a&quot;</span>        <span class="o">:</span> <span class="s">&quot;dispatch&quot;</span>
      <span class="s">&quot;click .policy-error button&quot;</span> <span class="o">:</span> <span class="s">&quot;close&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>We need to brute force the View's container to the 
WorkspaceCanvasView's el</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">initialize : </span><span class="nf">(options) -&gt;</span>
      <span class="vi">@view         = </span><span class="nx">options</span><span class="p">.</span><span class="nx">view</span>
      <span class="vi">@el           = </span><span class="nx">options</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">el</span>
      <span class="vi">@$el          = </span><span class="nx">options</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">$el</span>
      <span class="vi">@controller   = </span><span class="nx">options</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">controller</span>
      <span class="vi">@services     = </span><span class="nx">@controller</span><span class="p">.</span><span class="nx">services</span>
      <span class="vi">@flash_loaded = </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>We have not been rendered</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@render_state = </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>PolicyModel has not loaded</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@loaded_state = </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Save current route state for this view</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@current_route = </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>If flash is not loaded, then on an activate event
we need to load the flash up. This prevents us
from loading always switching to the overview
on tab activation</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@</span><span class="kc">on</span> <span class="s">&#39;activate&#39;</span><span class="p">,</span> <span class="nf">() -&gt;</span>
        <span class="k">if</span> <span class="nx">@loaded_state</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>This is our first load, so show the SWF</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="nx">@render</span><span class="p">()</span>
            <span class="nx">@show_overview</span><span class="p">()</span>
            <span class="nx">@teardown_ipmchanges</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Only show it again if this is the overview route </p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">else</span> <span class="k">if</span> <span class="nx">@current_route</span> <span class="o">==</span> <span class="s">&#39;overview&#39;</span> <span class="o">||</span> <span class="nx">@current_route</span> <span class="o">==</span> <span class="kc">null</span>
            <span class="nx">@show_overview</span><span class="p">()</span>
            <span class="nx">@teardown_ipmchanges</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>On deactivate we destroy the SWF compltely. We have to do this so we
can fine window.reload() when you switch back to this tab, otherwise it
reloads anyway, but doesn't get any of the data from the server, and
is therefore useless</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@</span><span class="kc">on</span> <span class="s">&#39;deactivate&#39;</span><span class="p">,</span> <span class="nf">() -&gt;</span>
        <span class="nx">@destroy_overview_swf</span><span class="p">()</span>

      <span class="nx">@</span><span class="kc">on</span> <span class="s">&#39;loaded&#39;</span><span class="p">,</span> <span class="nf">() -&gt;</span>
        <span class="vi">@loaded_state = </span><span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Our default state is to show the SWF overview</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="nx">@controller</span><span class="p">.</span><span class="nx">active_view</span><span class="p">.</span><span class="nx">cid</span> <span class="o">==</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">cid</span>
          <span class="nx">@trigger</span> <span class="s">&#39;activate&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>If a Policy 404s or otherwise dies we need a solid error message
for the user.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@</span><span class="kc">on</span> <span class="s">&#39;error&#39;</span><span class="p">,</span> <span class="nf">(msg) -&gt;</span>
        <span class="vi">@loaded_state = </span><span class="kc">true</span>
        <span class="nx">@renderError</span> <span class="nx">msg</span>
        <span class="k">if</span> <span class="nx">@controller</span><span class="p">.</span><span class="nx">active_view</span><span class="p">.</span><span class="nx">cid</span> <span class="o">==</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">cid</span>
          <span class="nx">@trigger</span> <span class="s">&#39;activate&#39;</span>

    <span class="nv">renderError : </span><span class="nf">(msg) -&gt;</span>
      <span class="nv">html = </span><span class="nx">@Mustache</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">tpl_policy_error</span><span class="p">,</span> <span class="p">{</span> <span class="nv">cid : </span><span class="nx">@cid</span><span class="p">,</span> <span class="nv">msg : </span><span class="nx">msg</span> <span class="p">})</span>
      <span class="nx">@$el</span><span class="p">.</span><span class="nx">html</span> <span class="nx">html</span>

    <span class="nv">render : </span><span class="nf">(options) -&gt;</span>
      <span class="k">if</span> <span class="nx">@render_state</span> <span class="o">==</span> <span class="kc">true</span>
        <span class="k">return</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Setup flash module &amp; search container</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">html = </span><span class="nx">@Mustache</span><span class="p">.</span><span class="nx">render</span> <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#tpl-flash-message&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(),</span> <span class="p">{</span> <span class="nv">cid : </span><span class="nx">@cid</span> <span class="p">}</span>
      
      <span class="k">if</span> <span class="o">!</span><span class="nx">options</span><span class="o">?</span>
        <span class="nx">html</span> <span class="o">+=</span> <span class="nx">@Mustache</span><span class="p">.</span><span class="nx">render</span> <span class="nx">tpl_policy_container</span><span class="p">,</span> <span class="p">{</span> <span class="nv">auth_digest : </span><span class="nx">@model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;digest&#39;</span><span class="p">),</span> <span class="nv">policy_id : </span><span class="nx">@model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;pxServerIndex&#39;</span><span class="p">),</span> <span class="nv">cid : </span><span class="nx">@cid</span> <span class="p">}</span>
      
      <span class="nx">@$el</span><span class="p">.</span><span class="nx">html</span> <span class="nx">html</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>This is to make sure we only render the one time
as we have some weird issues where render is call 
multiple times (still tracking down.)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">@render_state</span> <span class="o">==</span> <span class="kc">false</span>
        <span class="vi">@render_state = </span><span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>If this is a non-IPM policy then remove IPM changes from nav
otherwise go ahead and create an IPMModule</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">@model</span><span class="p">.</span><span class="nx">isIPM</span><span class="p">()</span> <span class="o">==</span> <span class="kc">false</span>
        <span class="nx">@$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;.policy-nav a[href=ipmchanges]&#39;</span><span class="p">).</span><span class="nx">parent</span><span class="p">(</span><span class="s">&#39;li&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
      <span class="k">else</span>
        <span class="vi">@IPM = </span><span class="k">new</span> <span class="nx">IPMModule</span><span class="p">(</span><span class="nx">@model</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">policy-ipm-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">),</span> <span class="nx">@controller</span><span class="p">.</span><span class="nx">user</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Cache commonly used jQuery elements</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@cache_elements</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Get an array of our policy-nav actions</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@actions = </span><span class="nx">@policy_nav_links</span><span class="p">.</span><span class="nx">map</span> <span class="nf">(idx, item) -&gt;</span> <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s">&#39;href&#39;</span><span class="p">)</span>

      <span class="nx">@build_policy_header</span><span class="p">()</span>
      <span class="nx">@policy_header</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Hide the view</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@$el</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Register flash message pubsub for this view</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@messenger = </span><span class="k">new</span> <span class="nx">Messenger</span><span class="p">(</span><span class="nx">@options</span><span class="p">.</span><span class="nx">view</span><span class="p">,</span> <span class="nx">@cid</span><span class="p">)</span>

      <span class="kc">true</span>   </pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Switch nav items on/off</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">toggle_nav_state : </span><span class="nf">(el) -&gt;</span>
      <span class="nx">@policy_nav_links</span><span class="p">.</span><span class="nx">removeClass</span> <span class="s">&#39;select&#39;</span>
      <span class="nx">el</span><span class="p">.</span><span class="nx">addClass</span> <span class="s">&#39;select&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Dynamically call methods based on href of #policy-nav elements
Because JavaScript is dynamic like that, yo.
SAFETY: We namespace the function signature and also make
sure it actually exists before attempting to call it.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">dispatch : </span><span class="nf">(e) -&gt;</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
      <span class="nv">$e     = </span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">)</span>
      <span class="nv">action = </span><span class="nx">$e</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&#39;href&#39;</span><span class="p">)</span>

      <span class="nx">@route</span> <span class="nx">action</span><span class="p">,</span> <span class="nx">$e</span>

    <span class="nv">close : </span><span class="nf">(e) -&gt;</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
      <span class="nx">@view</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>
      <span class="nx">@controller</span><span class="p">.</span><span class="nx">reassess_apps</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p><strong>Route</strong> <br />
Call the <code>action</code> and teardown all other views</p>

<p>@param <code>action</code> <em>String</em> action name <br />
@param <code>el</code> <em>HTML Element</em> <br />
@return <em>Boolean</em>  </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">route : </span><span class="nf">(action, el) -&gt;</span>
      <span class="k">if</span> <span class="o">!</span><span class="nx">action</span><span class="o">?</span>
        <span class="kc">false</span>
      <span class="vi">@current_route = </span><span class="nx">action</span>
      <span class="nx">@teardown_actions</span> <span class="nx">_</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">@actions</span><span class="p">,</span> <span class="nf">(item) -&gt;</span> 
        <span class="k">return</span> <span class="nx">item</span> <span class="o">!=</span> <span class="nx">action</span>
      <span class="p">)</span>
      <span class="nx">@toggle_nav_state</span> <span class="nx">el</span> <span class="c1"># turn select state on/off</span>

      <span class="nv">func = </span><span class="nx">@</span><span class="p">[</span><span class="s">&quot;show_</span><span class="si">#{</span><span class="nx">action</span><span class="si">}</span><span class="s">&quot;</span><span class="p">]</span>
      <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span>
        <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>

      <span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Take an array of actions (or action) and use it
to call it's teardown function (if it exists)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">teardown_actions : </span><span class="nf">(actions) -&gt;</span>
      <span class="k">if</span> <span class="nx">actions</span> <span class="o">==</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">actions</span> <span class="o">==</span> <span class="kc">null</span>
        <span class="k">return</span> <span class="kc">false</span>

      <span class="k">if</span> <span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">actions</span><span class="p">)</span>
        <span class="nv">actions = </span><span class="p">[</span><span class="nx">actions</span><span class="p">]</span>

      <span class="k">for</span> <span class="nx">action</span> <span class="k">in</span> <span class="nx">actions</span>
        <span class="nv">func = </span><span class="nx">@</span><span class="p">[</span><span class="s">&quot;teardown_</span><span class="si">#{</span><span class="nx">action</span><span class="si">}</span><span class="s">&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span>
          <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Namespace page elements</p>

<p>Since we have multiple instances we use the view cid
to keep everyone's ID separate. We store refs to these
in vars to keep things in one place keep jQuery traversal
to a minimum.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">cache_elements : </span><span class="o">-&gt;</span>
      <span class="vi">@iframe_id        = </span><span class="s">&quot;</span><span class="err">#</span><span class="s">policy-iframe-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span>
      <span class="vi">@iframe           = </span><span class="nx">@$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">@iframe_id</span><span class="p">)</span>
      <span class="vi">@policy_header    = </span><span class="nx">@$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">policy-header-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
      <span class="vi">@policy_nav_links = </span><span class="nx">@$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">policy-nav-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s"> a&quot;</span><span class="p">)</span>
      <span class="vi">@policy_summary   = </span><span class="nx">@$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">policy-summary-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>If the policy_header doesn't exist then build it, otherwise
just make visible</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">build_policy_header : </span><span class="o">-&gt;</span>
      <span class="k">if</span> <span class="nx">@policy_header</span><span class="p">.</span><span class="nx">html</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;&quot;</span>
        <span class="nx">@policy_header</span><span class="p">.</span><span class="nx">html</span> <span class="nx">@Mustache</span><span class="p">.</span><span class="nx">render</span> <span class="nx">tpl_ipm_header</span><span class="p">,</span> <span class="nx">@model</span><span class="p">.</span><span class="nx">getIpmHeader</span><span class="p">()</span>
      
      <span class="nx">@policy_header</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
      <span class="vi">@POLICY_HEADER_OFFSET = </span><span class="nx">@policy_header</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span>

    <span class="nv">resize_view : </span><span class="nf">(element, offset) -&gt;</span>
      <span class="nv">offset = </span><span class="nx">offset</span> <span class="o">?</span> <span class="nx">@POLICY_HEADER_OFFSET</span>
      <span class="nx">@Helpers</span><span class="p">.</span><span class="nx">resize_element</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">offset</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Load Flex Policy Summary</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">show_overview : </span><span class="o">-&gt;</span>
      <span class="nx">@$el</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>SWFObject deletes the policy-summary container when it removes Flash
so we need to check if its there and drop it back in if its not</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">@$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">policy-summary-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">).</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span>
        <span class="nx">@$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">policy-header-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">).</span><span class="nx">after</span><span class="p">(</span><span class="s">&quot;&quot;&quot;&lt;div id=&quot;policy-summary-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot; class=&quot;policy-iframe policy-swf&quot;&gt;&lt;/div&gt;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="vi">@policy_summary = </span><span class="nx">@$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">policy-summary-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>

      <span class="k">if</span> <span class="nx">@$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">policy-workspace-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="nx">@resize_view</span><span class="p">(</span><span class="nx">@$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">policy-workspace-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Now attach a resize event to the window to help Flash</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">resizer = </span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span>
          <span class="o">-&gt;</span>
            <span class="nx">@resize_view</span><span class="p">(</span><span class="nx">@$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">policy-workspace-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>         
          <span class="p">,</span> <span class="k">this</span><span class="p">)</span>
        <span class="nv">resize = </span><span class="nx">_</span><span class="p">.</span><span class="nx">debounce</span><span class="p">(</span><span class="nx">resizer</span><span class="p">,</span> <span class="mi">300</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">resize</span><span class="p">(</span><span class="nx">resize</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>We need to hook into the correct flash container
using SWFObject (hackety hack hack)</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">flash_obj = </span><span class="nx">$</span><span class="p">(</span><span class="nx">swfobject</span><span class="p">.</span><span class="nx">getObjectById</span><span class="p">(</span><span class="s">&quot;policy-summary-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>WebKit doesn't seem able to hook into getObjectById so we
fall back to jQuery</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span> <span class="nx">flash_obj</span>
          <span class="nv">flash_obj = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">policy-summary-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="nx">flash_obj</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s">&#39;visibility&#39;</span><span class="p">,</span> <span class="s">&#39;visible&#39;</span><span class="p">).</span><span class="nx">height</span><span class="p">(</span><span class="s">&#39;93%&#39;</span><span class="p">)</span>

      <span class="k">if</span> <span class="nx">@flash_loaded</span> <span class="o">is</span> <span class="kc">false</span>
        <span class="nx">swfobject</span><span class="p">.</span><span class="nx">embedSWF</span><span class="p">(</span>
          <span class="s">&quot;../swf/PolicySummary.swf&quot;</span><span class="p">,</span>
          <span class="s">&quot;policy-summary-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span>
          <span class="s">&quot;100%&quot;</span><span class="p">,</span>
          <span class="s">&quot;93%&quot;</span><span class="p">,</span> <span class="c1"># @policy_summary.height(),</span>
          <span class="s">&quot;9.0.0&quot;</span>
          <span class="kc">null</span><span class="p">,</span>
          <span class="kc">null</span><span class="p">,</span>
          <span class="p">{</span>
            <span class="nv">allowScriptAccess : </span><span class="s">&#39;always&#39;</span>
          <span class="p">},</span>
          <span class="kc">null</span><span class="p">,</span>
          <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
            <span class="nx">@flash_callback</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
        <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Hide flash overview</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">teardown_overview : </span><span class="o">-&gt;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">policy-summary-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s">&#39;visibility&#39;</span><span class="p">,</span> <span class="s">&#39;hidden&#39;</span><span class="p">).</span><span class="nx">height</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Remove SWFObject/Flash</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">destroy_overview_swf : </span><span class="o">-&gt;</span>
      <span class="nx">swfobject</span><span class="p">.</span><span class="nx">removeSWF</span><span class="p">(</span><span class="s">&quot;policy-summary-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
      <span class="vi">@flash_loaded = </span><span class="kc">false</span>

    <span class="nv">flash_callback : </span><span class="nf">(e) -&gt;</span>
      <span class="k">if</span> <span class="o">not</span> <span class="nx">e</span><span class="p">.</span><span class="nx">success</span> <span class="o">or</span> <span class="nx">e</span><span class="p">.</span><span class="nx">success</span> <span class="o">is</span> <span class="o">not</span> <span class="kc">true</span>
        <span class="nx">@Amplify</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="nx">@cid</span><span class="p">,</span> <span class="s">&#39;warning&#39;</span><span class="p">,</span> <span class="s">&quot;We could not launch the Flash player to load the summary. Sorry.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Grab the SWF ready() function for ourselves!</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nb">window</span><span class="p">.</span><span class="nv">policyViewInitSWF = </span><span class="o">=&gt;</span>
        <span class="nx">@initialize_swf</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>When the SWF calls ready() this is fired and passed
policy data along</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">initialize_swf : </span><span class="o">-&gt;</span>
      <span class="k">if</span> <span class="nx">@flash_loaded</span> <span class="o">is</span> <span class="kc">true</span>
        <span class="k">return</span> <span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>We need to get some global workspace information to pass along
to our SWF
workspace = @controller.workspace_state.get('workspace')</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">config    = </span><span class="nx">@controller</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">get_config</span><span class="p">(</span><span class="nx">@controller</span><span class="p">.</span><span class="nx">workspace_state</span><span class="p">)</span>

      <span class="k">if</span> <span class="o">not</span> <span class="nx">config</span><span class="o">?</span>
        <span class="nx">@Amplify</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="nx">@cid</span><span class="p">,</span> <span class="s">&#39;warning&#39;</span><span class="p">,</span> <span class="s">&quot;There was a problem with the configuration for this policy. Sorry.&quot;</span><span class="p">)</span>

      <span class="nv">obj      = </span><span class="nx">swfobject</span><span class="p">.</span><span class="nx">getObjectById</span><span class="p">(</span><span class="s">&quot;policy-summary-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="nv">digest   = </span><span class="nx">Base64</span><span class="p">.</span><span class="nx">decode</span><span class="p">(</span><span class="nx">@model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;digest&#39;</span><span class="p">)).</span><span class="nx">split</span> <span class="s">&#39;:&#39;</span>
      <span class="nv">settings =</span>
        <span class="s">&quot;parentAuthtoken&quot;</span>   <span class="o">:</span> <span class="s">&quot;Y29tLmljczM2MC5hcHBzLmluc2lnaHRjZW50cmFsOjg4NTllY2IzNmU1ZWIyY2VkZTkzZTlmYTc1YzYxZDRl&quot;</span><span class="p">,</span>
        <span class="s">&quot;policyId&quot;</span>          <span class="o">:</span> <span class="nx">@model</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
        <span class="s">&quot;applicationid&quot;</span>     <span class="o">:</span> <span class="s">&quot;ixadmin&quot;</span><span class="p">,</span>
        <span class="s">&quot;organizationid&quot;</span>    <span class="o">:</span> <span class="s">&quot;ics&quot;</span><span class="p">,</span>
        <span class="s">&quot;masterEnvironment&quot;</span> <span class="o">:</span> <span class="nb">window</span><span class="p">.</span><span class="nx">ICS360_ENV</span>

      <span class="k">if</span> <span class="nx">digest</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">?</span> <span class="o">and</span> <span class="nx">digest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">?</span>
        <span class="nx">obj</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">digest</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">digest</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">config</span><span class="p">,</span> <span class="nx">settings</span><span class="p">)</span>
      <span class="k">else</span>
        <span class="nx">@Amplify</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="nx">@cid</span><span class="p">,</span> <span class="s">&#39;warning&#39;</span><span class="p">,</span> <span class="s">&quot;There was a problem with your credentials for this policy. Sorry.&quot;</span><span class="p">)</span>

      <span class="vi">@flash_loaded = </span><span class="kc">true</span> <span class="c1"># set state</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Load mxAdmin into workarea and inject policy header</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">show_ipmchanges : </span><span class="o">-&gt;</span>      
      <span class="nv">ipm_container = </span><span class="nx">@$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">policy-ipm-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
      <span class="nx">ipm_container</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
      <span class="nx">@resize_view</span><span class="p">(</span><span class="nx">ipm_container</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Hide IPM Changes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">teardown_ipmchanges : </span><span class="o">-&gt;</span>
      <span class="nv">ipm_container = </span><span class="nx">@$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">policy-ipm-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
      <span class="nx">ipm_container</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Load Renewal Underwriting Views</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">show_renewalunderwriting : </span><span class="o">-&gt;</span>
      <span class="nv">$ru_el = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">renewal-underwriting-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">$ru_el</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">policy-workspace-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">).</span><span class="nx">append</span> <span class="nx">@Mustache</span><span class="p">.</span><span class="nx">render</span> <span class="nx">tpl_ru_wrapper</span><span class="p">,</span> <span class="p">{</span> <span class="nv">cid : </span><span class="nx">@cid</span> <span class="p">}</span>
        <span class="nv">$ru_el = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">renewal-underwriting-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="nx">$ru_el</span><span class="p">.</span><span class="nx">addClass</span> <span class="s">&#39;policy-module&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>If container not already loaded, then insert element into DOM</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">@ru_container</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">@ru_container</span> <span class="o">==</span> <span class="kc">undefined</span>
        <span class="vi">@ru_container = </span><span class="k">new</span> <span class="nx">RenewalUnderwritingView</span><span class="p">({</span>
            <span class="nv">$el         : </span><span class="nx">$ru_el</span>
            <span class="nv">policy      : </span><span class="nx">@model</span>
            <span class="nv">policy_view : </span><span class="k">this</span>
          <span class="p">}).</span><span class="nx">render</span><span class="p">()</span>
      <span class="k">else</span>
        <span class="nx">@ru_container</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>

    <span class="nv">teardown_renewalunderwriting : </span><span class="o">-&gt;</span>
      <span class="nv">$ru_el = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">renewal-underwriting-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">$ru_el</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="nx">@ru_container</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>

    <span class="nv">show_servicerequests : </span><span class="o">-&gt;</span>
      <span class="nv">$zd_el = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">zendesk-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">$zd_el</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">policy-workspace-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s">&quot;&lt;div id=\&quot;zendesk-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">\&quot; class=\&quot;zd-container\&quot;&gt;&lt;/div&gt;&quot;</span><span class="p">)</span>
        <span class="nv">$zd_el = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">zendesk-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="nx">$zd_el</span><span class="p">.</span><span class="nx">addClass</span> <span class="s">&#39;policy-module&#39;</span>

      <span class="nx">@resize_view</span><span class="p">(</span><span class="nx">@$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">$zd_el</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>If container not already loaded, then insert element into DOM</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">@zd_container</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">@zd_container</span> <span class="o">==</span> <span class="kc">undefined</span>
        <span class="vi">@zd_container = </span><span class="k">new</span> <span class="nx">ZenDeskView</span><span class="p">({</span>
            <span class="nv">$el         : </span><span class="nx">$zd_el</span>
            <span class="nv">policy      : </span><span class="nx">@model</span>
            <span class="nv">policy_view : </span><span class="k">this</span>
          <span class="p">}).</span><span class="nx">fetch</span><span class="p">()</span>
      <span class="k">else</span>
        <span class="nx">@zd_container</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>

    <span class="nv">teardown_servicerequests : </span><span class="o">-&gt;</span>
      <span class="nv">$zd_el = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">zendesk-</span><span class="si">#{</span><span class="nx">@cid</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">$zd_el</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="nx">@zd_container</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>

  <span class="nx">PolicyView</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 